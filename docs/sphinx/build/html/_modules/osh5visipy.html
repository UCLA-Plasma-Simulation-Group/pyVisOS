
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>osh5visipy &#8212; pyVisOS 1.0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for osh5visipy</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">osh5visipy.py</span>
<span class="sd">=============</span>
<span class="sd">Vis tools for the OSIRIS HDF5 data.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="k">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">Layout</span><span class="p">,</span> <span class="n">Output</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">FileLink</span><span class="p">,</span> <span class="n">clear_output</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">osh5vis</span>
<span class="kn">import</span> <span class="nn">osh5io</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="k">import</span> <span class="n">LogNorm</span><span class="p">,</span> <span class="n">Normalize</span><span class="p">,</span> <span class="n">PowerNorm</span><span class="p">,</span> <span class="n">SymLogNorm</span>
<span class="kn">from</span> <span class="nn">matplotlib._pylab_helpers</span> <span class="k">import</span> <span class="n">Gcf</span> <span class="k">as</span> <span class="n">pylab_gcf</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">re</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Importing osh5visipy. Please use `%matplotlib notebook&#39; in your jupyter/ipython notebook;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;use `%matplotlib widget&#39; if you are using newer version of matplotlib (3.0) + jupyterlab (0.35)&quot;</span><span class="p">)</span>


<span class="n">do_nothing</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span>
<span class="n">_items_layout</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">(</span><span class="n">flex</span><span class="o">=</span><span class="s1">&#39;1 1 auto&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">_get_delete_btn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">tp</span> <span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;delete </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tp</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;times&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;32px&#39;</span><span class="p">))</span>


<span class="n">__2dplot_param_doc</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    2D plot with widgets</span>
<span class="s2">    :param data: (list of) 2D H5Data</span>
<span class="s2">    :param args: arguments passed to 2d plotting widgets. reserved for future use</span>
<span class="s2">    :param show: whether to show the widgets</span>
<span class="s2">    :param grid: a tuple (row, column) specifying the layout of subplots. Must be set when plotting more than one subplot</span>
<span class="s2">    :param kwargs: keyword arguments passed to 2d plotting widgets. reserved for future use</span>
<span class="s2">    :return: if show == True return None otherwise return a list of widgets</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">__2dplot_example_doc</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    example usage:</span>
<span class="s2">        os</span><span class="si">%s</span><span class="s2">_w(filename)  # filename is a string, display </span><span class="si">%s</span><span class="s2"> of the file with filename</span>

<span class="s2">        os</span><span class="si">%s</span><span class="s2">_w(data)  # data is a H5Data variable, display </span><span class="si">%s</span><span class="s2"> of data</span>

<span class="s2">        os</span><span class="si">%s</span><span class="s2">_w((filename1, filename2, filename3), grid=(3,1))  # display </span><span class="si">%s</span><span class="s2"> of 3 files in 3 rows</span>

<span class="s2">        os</span><span class="si">%s</span><span class="s2">_w((data1, data2, data3, data4), grid=(2,2))  # display </span><span class="si">%s</span><span class="s2"> of 4  H5Data variables in a 2 by 2 grid</span>
<span class="s2">&quot;&quot;&quot;</span>


<span class="k">def</span> <span class="nf">os2dplot_w</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">pltfunc</span><span class="o">=</span><span class="n">osh5vis</span><span class="o">.</span><span class="n">osimshow</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;%s&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">__2dplot_param_doc</span> <span class="o">+</span> <span class="p">(</span><span class="n">__2dplot_example_doc</span> <span class="o">%</span> <span class="p">((</span><span class="s1">&#39;pltfunc&#39;</span><span class="p">,</span> <span class="p">)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">h5data</span> <span class="o">=</span> <span class="n">osh5io</span><span class="o">.</span><span class="n">read_h5</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">wl</span> <span class="o">=</span> <span class="n">Generic2DPlotCtrl</span><span class="p">(</span><span class="n">h5data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">pltfunc</span><span class="o">=</span><span class="n">pltfunc</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">widgets_list</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">grid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Specify the grid layout when plotting more than one quantity!&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">osh5io</span><span class="o">.</span><span class="n">read_h5</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
        <span class="n">wl</span> <span class="o">=</span> <span class="n">MultiPanelCtrl</span><span class="p">((</span><span class="n">Generic2DPlotCtrl</span><span class="p">,)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">data</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">widgets_list</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wl</span> <span class="o">=</span> <span class="n">Generic2DPlotCtrl</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">pltfunc</span><span class="o">=</span><span class="n">pltfunc</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">widgets_list</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">display</span><span class="p">(</span><span class="o">*</span><span class="n">wl</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">wl</span>


<span class="n">osimshow_w</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">os2dplot_w</span><span class="p">,</span> <span class="n">pltfunc</span><span class="o">=</span><span class="n">osh5vis</span><span class="o">.</span><span class="n">osimshow</span><span class="p">)</span>
<span class="n">osimshow_w</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span>  <span class="o">%</span> <span class="p">(</span><span class="n">__2dplot_param_doc</span> <span class="o">+</span> <span class="p">(</span><span class="n">__2dplot_example_doc</span> <span class="o">%</span> <span class="p">((</span><span class="s1">&#39;imshow&#39;</span><span class="p">,)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)))</span>
<span class="n">oscontour_w</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">os2dplot_w</span><span class="p">,</span> <span class="n">pltfunc</span><span class="o">=</span><span class="n">osh5vis</span><span class="o">.</span><span class="n">oscontour</span><span class="p">)</span>
<span class="n">oscontour_w</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span>  <span class="o">%</span> <span class="p">(</span><span class="n">__2dplot_param_doc</span> <span class="o">+</span> <span class="p">(</span><span class="n">__2dplot_example_doc</span> <span class="o">%</span> <span class="p">((</span><span class="s1">&#39;contour&#39;</span><span class="p">,)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)))</span>
<span class="n">oscontourf_w</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">os2dplot_w</span><span class="p">,</span> <span class="n">pltfunc</span><span class="o">=</span><span class="n">osh5vis</span><span class="o">.</span><span class="n">oscontourf</span><span class="p">)</span>
<span class="n">oscontourf_w</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span>  <span class="o">%</span> <span class="p">(</span><span class="n">__2dplot_param_doc</span> <span class="o">+</span> <span class="p">(</span><span class="n">__2dplot_example_doc</span> <span class="o">%</span> <span class="p">((</span><span class="s1">&#39;contourf&#39;</span><span class="p">,)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)))</span>


<div class="viewcode-block" id="slicer_w"><a class="viewcode-back" href="../osh5visipy.html#osh5visipy.slicer_w">[docs]</a><span class="k">def</span> <span class="nf">slicer_w</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">slider_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A slider for 3D data</span>
<span class="sd">    :param data: (a list of) 3D H5Data or directory name (a string)</span>
<span class="sd">    :param args: arguments passed to plotting widgets. reserved for future use</span>
<span class="sd">    :param show: whether to show the widgets</span>
<span class="sd">    :param slider_only: if True only show the slider otherwise show also other plot control (aka &#39;the tab&#39;)</span>
<span class="sd">    :param kwargs: keyword arguments passed to 2d plotting widgets. reserved for future use</span>
<span class="sd">    :return: whatever widgets that are not shown</span>
<span class="sd">    example usage:</span>
<span class="sd">        slicer_w(dirname)  # dirname is the name of a directory, display the quantity inside dirname,</span>
<span class="sd">                           # slider bar let you choose which file to display</span>

<span class="sd">        slicer_w(data)  # data is a 3d H5Data variable, slider bar let you choose the position along certain axis</span>

<span class="sd">        slicer_w((dirname1, dirname2, dirname3, dirname4), grid=(2, 2))  # display 4 subplots in a 2 by 2 grid,</span>
<span class="sd">                                                                         # slider bar let you choose which time step to display,</span>
<span class="sd">                                                                         # number of files in dirname# should be the same</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">wl</span> <span class="o">=</span> <span class="n">DirSlicer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">widgets_list</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="n">wl</span> <span class="o">=</span> <span class="n">MPDirSlicer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">widgets_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Unexpected data. Cannot process input parameters&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wl</span> <span class="o">=</span> <span class="n">Slicer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">widgets_list</span>
    <span class="n">tab</span><span class="p">,</span> <span class="n">slider</span> <span class="o">=</span> <span class="n">wl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">(</span><span class="n">wl</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">slider_only</span><span class="p">:</span>
            <span class="n">display</span><span class="p">(</span><span class="n">slider</span><span class="p">,</span> <span class="n">wl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">tab</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">display</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">slider</span><span class="p">,</span> <span class="n">wl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">wl</span></div>


<span class="k">def</span> <span class="nf">animation_w</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">wl</span> <span class="o">=</span> <span class="n">Animation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">widgets_list</span>
    <span class="n">display</span><span class="p">(</span><span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">wl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">(</span><span class="n">wl</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]),</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">(</span><span class="n">wl</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">(</span><span class="n">wl</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])]))</span>


<span class="k">class</span> <span class="nc">FigureManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">managers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">figures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshbtn</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;refresh&#39;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;get all currently opened figures&#39;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;refresh&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deletebtn</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;delete&#39;</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;delete this figure&#39;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;trash&#39;</span><span class="p">,</span> <span class="n">button_style</span><span class="o">=</span><span class="s1">&#39;danger&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ToggleButtons</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figures</span><span class="p">))),</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Figures:&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="c1">#                                                   layout=_items_layout, style={&#39;description_width&#39;: &#39;initial&#39;, &quot;button_width&quot;: &#39;initial&#39;})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="n">Output</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display_figure</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshbtn</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh_wgt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deletebtn</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">refreshbtn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deletebtn</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection</span><span class="p">])</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">:</span>
            <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_widget</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">display_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">:</span>
            <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_widget</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figures</span><span class="p">[</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span>

<span class="c1">#     @widget.setter</span>
<span class="c1">#     def widget(self, value):</span>
<span class="c1">#         self._widget = value</span>

    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mngr</span> <span class="o">=</span> <span class="p">[</span><span class="n">manager</span> <span class="k">for</span> <span class="n">manager</span> <span class="ow">in</span> <span class="n">pylab_gcf</span><span class="o">.</span><span class="n">get_all_fig_managers</span><span class="p">()]</span>
        <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mngr</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">mngr</span><span class="p">,</span> <span class="n">f</span>

    <span class="k">def</span> <span class="nf">refresh_wgt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">managers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">figures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection</span><span class="o">.</span><span class="n">options</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figures</span><span class="p">))),</span> <span class="mi">0</span>
<span class="c1">#         self._widget = widgets.VBox([widgets.HBox([self.refreshbtn, self.deletebtn]), self.selection, self.display])</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selection</span><span class="o">.</span><span class="n">value</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_wgt</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_get_downloadable_url</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;&lt;a href=&quot;files</span><span class="si">%s</span><span class="s1">&quot; download=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt; </span><span class="si">%s</span><span class="s1"> &lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
                                                         <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">filename</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Generic2DPlotCtrl</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">tab_contents</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">,</span> <span class="s1">&#39;Axes&#39;</span><span class="p">,</span> <span class="s1">&#39;Overlay&#39;</span><span class="p">,</span> <span class="s1">&#39;Colorbar&#39;</span><span class="p">,</span> <span class="s1">&#39;Save&#39;</span><span class="p">,</span> <span class="s1">&#39;Figure&#39;</span><span class="p">]</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-40</span>
    <span class="n">colormaps_available</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">colormaps</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_r&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">pltfunc</span><span class="o">=</span><span class="n">osh5vis</span><span class="o">.</span><span class="n">osimshow</span><span class="p">,</span> <span class="n">slcs</span><span class="o">=</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">)),</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_in_title</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">phys_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">onDestruction</span><span class="o">=</span><span class="n">do_nothing</span><span class="p">,</span>
                 <span class="n">convert_xaxis</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">convert_yaxis</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">register_callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">im_xlt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_in_title</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pltfunc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onDestruction</span> <span class="o">=</span> \
        <span class="n">data</span><span class="p">,</span> <span class="n">slcs</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">time_in_title</span><span class="p">,</span> <span class="n">pltfunc</span><span class="p">,</span> <span class="n">onDestruction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">register_callbacks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">register_callbacks</span>
        <span class="n">user_cmap</span><span class="p">,</span> <span class="n">show_colorbar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="s1">&#39;jet&#39;</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;colorbar&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># # # -------------------- Tab0 --------------------------</span>
        <span class="c1"># title</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">osh5vis</span><span class="o">.</span><span class="n">default_title</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">show_time</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">t_in_axis</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">has_axis</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_reset_title</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Auto&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datalabel</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                     <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Data Name:&#39;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">if_reset_title</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_show_time</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">time_in_title</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">t_in_axis</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Time in title, &#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_in_phys</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">phys_time</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;time in physical unit&#39;</span><span class="p">,</span>
                                            <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="n">lognorm</span> <span class="o">=</span> <span class="n">norm</span> <span class="o">==</span> <span class="s1">&#39;Log&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__pp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span> <span class="k">if</span> <span class="n">lognorm</span> <span class="k">else</span> <span class="n">do_nothing</span>
        <span class="k">if</span> <span class="s1">&#39;clim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;clim&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vmin</span><span class="p">,</span> <span class="n">auto_vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;clim&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="kc">False</span>
                <span class="n">logvmin</span> <span class="o">=</span> <span class="n">vmin</span> <span class="k">if</span> <span class="n">lognorm</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vmin</span><span class="p">,</span> <span class="n">logvmin</span><span class="p">,</span> <span class="n">auto_vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;clim&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vmax</span><span class="p">,</span> <span class="n">auto_vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;clim&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vmax</span><span class="p">,</span> <span class="n">auto_vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vmin</span><span class="p">,</span> <span class="n">logvmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">auto_vmin</span><span class="p">,</span> <span class="n">auto_vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span>
        <span class="c1"># normalization</span>
        <span class="c1"># general parameters: vmin, vmax, clip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_vmin_auto</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">auto_vmin</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Auto&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_vmax_auto</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">auto_vmax</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Auto&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmin_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;vmin:&#39;</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                          <span class="n">disabled</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">if_vmin_auto</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vlogmin_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">logvmin</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;vmin:&#39;</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                             <span class="n">disabled</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">if_vmin_auto</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmax_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;vmax:&#39;</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                          <span class="n">disabled</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">if_vmax_auto</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_clip_cm</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Clip&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="c1"># PowerNorm specific</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;gamma:&#39;</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                       <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="c1"># SymLogNorm specific</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linthresh</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;linthresh:&#39;</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                           <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linscale</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;linscale:&#39;</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                          <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>

        <span class="c1"># build the widgets tuple</span>
        <span class="n">ln_wgt</span> <span class="o">=</span> <span class="p">(</span><span class="n">LogNorm</span><span class="p">,</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax_wgt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmax_auto</span><span class="p">]),</span>
                                         <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">vlogmin_wgt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmin_auto</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_clip_cm</span><span class="p">]))</span>
        <span class="n">n_wgt</span> <span class="o">=</span> <span class="p">(</span><span class="n">Normalize</span><span class="p">,</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax_wgt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmax_auto</span><span class="p">]),</span>
                                          <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin_wgt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmin_auto</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_clip_cm</span><span class="p">]))</span>
        <span class="n">pn_wgt</span> <span class="o">=</span> <span class="p">(</span><span class="n">PowerNorm</span><span class="p">,</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax_wgt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmax_auto</span><span class="p">]),</span>
                                           <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin_wgt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmin_auto</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_clip_cm</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">]))</span>
        <span class="n">sln_wgt</span> <span class="o">=</span> <span class="p">(</span><span class="n">SymLogNorm</span><span class="p">,</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">(</span>
            <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax_wgt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmax_auto</span><span class="p">]),</span>
             <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin_wgt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmin_auto</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_clip_cm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">linthresh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">linscale</span><span class="p">]))</span>

        <span class="c1"># find out default value for norm_selector</span>
        <span class="n">norm_avail</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Log&#39;</span><span class="p">:</span> <span class="n">ln_wgt</span><span class="p">,</span> <span class="s1">&#39;Normalize&#39;</span><span class="p">:</span> <span class="n">n_wgt</span><span class="p">,</span> <span class="s1">&#39;Power&#39;</span><span class="p">:</span> <span class="n">pn_wgt</span><span class="p">,</span> <span class="s1">&#39;SymLog&#39;</span><span class="p">:</span> <span class="n">sln_wgt</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm_selector</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">norm_avail</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span>
                                              <span class="n">value</span><span class="o">=</span><span class="n">norm_avail</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="n">n_wgt</span><span class="p">),</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Normalization:&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__old_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_selector</span><span class="o">.</span><span class="n">value</span>
        <span class="c1"># additional care for LorNorm()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__handle_lognorm</span><span class="p">()</span>
<span class="c1">#         self.vmin_wgt.value, self.vlogmin_wgt.value, self.vmax_wgt.value = vmin, logvmin, vmax</span>
        <span class="c1"># re-plot button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm_btn_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Apply&#39;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;Update normalization&#39;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;refresh&#39;</span><span class="p">)</span>
        <span class="n">tab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_tab_data</span><span class="p">())</span>

        <span class="c1"># # # -------------------- Tab1 --------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_xrange_auto</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Auto xrange&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_yrange_auto</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Auto yrange&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_range_btn</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Apply&#39;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> \
                                              <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;set range. (* this will delete all overlaid plots *)&#39;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;refresh&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_lim_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">if_xrange_auto</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_yrange_auto</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_range_btn</span><span class="p">])</span>
        <span class="c1"># x axis</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xinc</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">yinc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_xy_minmax_delta</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">convert_xaxis</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">,</span> <span class="n">xunit</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">punit_convert_factor</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">,</span> <span class="n">xunit</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_min_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">xmin</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">xmin</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">xinc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;xmin:&#39;</span><span class="p">,</span>
                                                  <span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_max_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">xmax</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">xmin</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">xinc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;xmax:&#39;</span><span class="p">,</span>
                                                  <span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_step_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">xinc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">xinc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                   <span class="n">description</span><span class="o">=</span><span class="s1">&#39;$\Delta x$:&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_min_wgt</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max_wgt</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max_wgt</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_min_wgt</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_min_wgt</span><span class="p">,</span> <span class="s1">&#39;disabled&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">if_xrange_auto</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max_wgt</span><span class="p">,</span> <span class="s1">&#39;disabled&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">if_xrange_auto</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_step_wgt</span><span class="p">,</span> <span class="s1">&#39;disabled&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">if_xrange_auto</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="c1"># x label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_reset_xlabel</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Auto&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_x_phys_unit</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">convert_xaxis</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;phys unit;  &#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xlabel</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">if_reset_xlabel</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xlabel</span> <span class="o">=</span> <span class="n">xlabel</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xlabel</span> <span class="o">=</span> <span class="n">osh5vis</span><span class="o">.</span><span class="n">axis_format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">long_name</span><span class="p">,</span> <span class="n">xunit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlabel</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlabel</span><span class="p">,</span>
                                   <span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">description</span><span class="o">=</span><span class="s1">&#39;X label:&#39;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">if_reset_xlabel</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">xlabel</span><span class="p">,</span> <span class="s1">&#39;disabled&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">if_reset_xlabel</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xaxis_lim_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">if_x_phys_unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_min_wgt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_max_wgt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_step_wgt</span><span class="p">,</span>
                                           <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">xlabel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_reset_xlabel</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">border</span><span class="o">=</span><span class="s1">&#39;solid 1px&#39;</span><span class="p">))])</span>
        <span class="c1"># y axis</span>
        <span class="k">if</span> <span class="n">convert_yaxis</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">,</span> <span class="n">yunit</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">punit_convert_factor</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">,</span> <span class="n">yunit</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_min_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">ymin</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">ymin</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">ymax</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">yinc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;ymin:&#39;</span><span class="p">,</span>
                                                  <span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_max_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">ymax</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">ymin</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">ymax</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">yinc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;ymax:&#39;</span><span class="p">,</span>
                                                  <span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_step_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">yinc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">yinc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;$\Delta y$:&#39;</span><span class="p">,</span>
                                                   <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y_min_wgt</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_max_wgt</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y_max_wgt</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_min_wgt</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y_min_wgt</span><span class="p">,</span> <span class="s1">&#39;disabled&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">if_yrange_auto</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y_max_wgt</span><span class="p">,</span> <span class="s1">&#39;disabled&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">if_yrange_auto</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y_step_wgt</span><span class="p">,</span> <span class="s1">&#39;disabled&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">if_xrange_auto</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="c1"># y label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_reset_ylabel</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Auto&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_y_phys_unit</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">convert_yaxis</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;phys unit;  &#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ylabel</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">if_reset_ylabel</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ylabel</span> <span class="o">=</span> <span class="n">ylabel</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ylabel</span> <span class="o">=</span> <span class="n">osh5vis</span><span class="o">.</span><span class="n">axis_format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">long_name</span><span class="p">,</span> <span class="n">yunit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ylabel</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ylabel</span><span class="p">,</span>
                                   <span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Y label:&#39;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">if_reset_ylabel</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ylabel</span><span class="p">,</span> <span class="s1">&#39;disabled&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">if_reset_ylabel</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yaxis_lim_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">if_y_phys_unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min_wgt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max_wgt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_step_wgt</span><span class="p">,</span>
                                           <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ylabel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_reset_ylabel</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">border</span><span class="o">=</span><span class="s1">&#39;solid 1px&#39;</span><span class="p">))])</span>
        <span class="n">tab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_lim_wgt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xaxis_lim_wgt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaxis_lim_wgt</span><span class="p">]))</span>

        <span class="c1"># # # -------------------- Tab2 --------------------------</span>
        <span class="n">overlay_item_layout</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s1">&#39;flex&#39;</span><span class="p">,</span> <span class="n">flex_flow</span><span class="o">=</span><span class="s1">&#39;row wrap&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__analysis_def</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Average&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Simple&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">a</span><span class="p">),</span> <span class="s1">&#39;RMS&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">a</span><span class="p">))},</span>
                               <span class="s1">&#39;Sum&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Simple&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">a</span><span class="p">),</span> <span class="s1">&#39;Square&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">a</span><span class="p">),</span>
                                       <span class="s1">&#39;ABS&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">a</span><span class="p">))},</span>
                               <span class="s1">&#39;Min&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Simple&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">a</span><span class="p">),</span> <span class="s1">&#39;ABS&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="n">a</span><span class="p">)},</span>
                               <span class="s1">&#39;Max&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Simple&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">a</span><span class="p">),</span> <span class="s1">&#39;ABS&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="n">a</span><span class="p">)}}</span> <span class="c1">#TODO: envelope</span>
        <span class="n">analist</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__analysis_def</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="c1"># x lineout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlineout_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span>
                                                     <span class="n">step</span><span class="o">=</span><span class="n">yinc</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ylabel</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">xlineout_wgt</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylabel</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">xlineout_wgt</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_min_wgt</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">xlineout_wgt</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_max_wgt</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">xlineout_wgt</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_step_wgt</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_xlineout_btn</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Lineout&#39;</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;Add x-lines&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="c1"># simple analysis in x direction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xananame</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">analist</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">analist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Analysis:&#39;</span><span class="p">,</span>
                                         <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="n">xanaoptlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__analysis_def</span><span class="p">[</span><span class="n">analist</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xanaopts</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">xanaoptlist</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">xanaoptlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                         <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anaxmin</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">yinc</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;from&#39;</span><span class="p">,</span>
                                                <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anaxmax</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">yinc</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;to&#39;</span><span class="p">,</span>
                                                <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">anaxmin</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_min_wgt</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">anaxmin</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anaxmax</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">anaxmin</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_step_wgt</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">anaxmax</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anaxmin</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">anaxmax</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_max_wgt</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">anaxmax</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_step_wgt</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xana_add</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;Add analysis as x line plot&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="n">xlinegroup</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">xananame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xanaopts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">anaxmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">anaxmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xana_add</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">border</span><span class="o">=</span><span class="s1">&#39;solid 1px&#39;</span><span class="p">))</span>
        <span class="c1"># list of x lines plotted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlineout_list_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="p">[],</span> <span class="n">layout</span><span class="o">=</span><span class="n">overlay_item_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlineout_tab</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">xlineout_wgt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_xlineout_btn</span><span class="p">],</span>
                                                                     <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">border</span><span class="o">=</span><span class="s1">&#39;solid 1px&#39;</span><span class="p">,</span> <span class="n">flex</span><span class="o">=</span><span class="s1">&#39;1 1 auto&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)),</span>
                                                        <span class="n">xlinegroup</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlineout_list_wgt</span><span class="p">])</span>
        <span class="c1"># y lineout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ylineout_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span>
                                                     <span class="n">step</span><span class="o">=</span><span class="n">xinc</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xlabel</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ylineout_wgt</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlabel</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ylineout_wgt</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_min_wgt</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ylineout_wgt</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max_wgt</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ylineout_wgt</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_step_wgt</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_ylineout_btn</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Lineout&#39;</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;Add y-lines&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="c1"># simple analysis in x direction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yananame</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">analist</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">analist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Analysis:&#39;</span><span class="p">,</span>
                                         <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="n">yanaoptlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__analysis_def</span><span class="p">[</span><span class="n">analist</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yanaopts</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">yanaoptlist</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">yanaoptlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                         <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anaymin</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">xinc</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;from&#39;</span><span class="p">,</span>
                                                <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anaymax</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">xinc</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;to&#39;</span><span class="p">,</span>
                                                <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">anaymin</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_min_wgt</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">anaymin</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anaymax</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">anaymin</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_step_wgt</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">anaymax</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anaymin</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">anaymax</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max_wgt</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">anaymax</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_step_wgt</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yana_add</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;Add analysis as y line plot&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="n">ylinegroup</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">yananame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yanaopts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">anaymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">anaymax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yana_add</span><span class="p">],</span>
                                  <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;initial&#39;</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="s1">&#39;solid 1px&#39;</span><span class="p">))</span>
        <span class="c1"># list of x lines plotted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ylineout_list_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="p">[],</span> <span class="n">layout</span><span class="o">=</span><span class="n">overlay_item_layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ylineout_tab</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ylineout_wgt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_ylineout_btn</span><span class="p">],</span>
                                                                     <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">border</span><span class="o">=</span><span class="s1">&#39;solid 1px&#39;</span><span class="p">,</span> <span class="n">flex</span><span class="o">=</span><span class="s1">&#39;1 1 auto&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)),</span>
                                                        <span class="n">ylinegroup</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylineout_list_wgt</span><span class="p">])</span>
<span class="c1">#         self.ct_alpha = widgets.BoundedFloatText(value=1.0, min=0., max=1., step=0.01, layout={&#39;width&#39;: &#39;initial&#39;}, style={&#39;description_width&#39;: &#39;initial&#39;})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_auto_color</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ToggleButtons</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;colormap&#39;</span><span class="p">,</span> <span class="s1">&#39;manual&#39;</span><span class="p">,</span> <span class="s1">&#39;same&#39;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Color:&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;colormap&#39;</span><span class="p">,</span>
                                                   <span class="n">tooltips</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;use selected colormap&#39;</span><span class="p">,</span> <span class="s1">&#39;set each level indevidually&#39;</span><span class="p">,</span> <span class="s1">&#39;monochromatic, same as the last level&#39;</span><span class="p">],</span>
                                                   <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">,</span> <span class="s2">&quot;button_width&quot;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_antialiased</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;antialiased; &#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_if_clabel</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;clabels &#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_if_inline_clabel</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;inline; &#39;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                    <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_cmap_selector</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colormaps_available</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">user_cmap</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;  colormap:&#39;</span><span class="p">,</span>
                                                 <span class="n">disabled</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ct_auto_color</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="s1">&#39;colormap&#39;</span><span class="p">),</span> <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_cmap_reverse</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Reverse; &#39;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ct_cmap_selector</span><span class="o">.</span><span class="n">disabled</span><span class="p">,</span>
                                                <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ct_cmap_reverse</span><span class="p">,</span> <span class="s1">&#39;disabled&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ct_cmap_selector</span><span class="p">,</span> <span class="s1">&#39;disabled&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_method</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;contour&#39;</span><span class="p">,</span> <span class="s1">&#39;contourf&#39;</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;contour&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_plot_btn</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Plot&#39;</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;plot overlay&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span> <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_opts_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_wgt_list</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="p">[],</span> <span class="n">layout</span><span class="o">=</span><span class="n">overlay_item_layout</span><span class="p">),</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="p">[],</span> <span class="n">layout</span><span class="o">=</span><span class="n">overlay_item_layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_opts_dict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_plot_dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>  <span class="c1"># dict to keep track of the overlaid plots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_num_levels_opts</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ToggleButtons</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;option&#39;</span><span class="p">,</span> <span class="s1">&#39;fixed:&#39;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39; number of levels:&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                                                        <span class="n">tooltips</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;let the plotter decide how many levels to plot&#39;</span><span class="p">,</span> <span class="s1">&#39;same number of levels as the level options added below&#39;</span><span class="p">,</span>
                                                                  <span class="s1">&#39;excact number of levels (some of the level options added below may not be used)&#39;</span><span class="p">],</span>
                                                        <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">,</span> <span class="s2">&quot;button_width&quot;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_num_levels</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedIntText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">MaxNLocator</span><span class="o">.</span><span class="n">MAXTICKS</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ct_num_levels_opts</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="s1">&#39;fixed:&#39;</span><span class="p">),</span>
                                                    <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_level</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;0.0&#39;</span><span class="p">,</span> <span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;0.0, 0.01, 10&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Levels=&#39;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ct_num_levels_opts</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="s1">&#39;option&#39;</span><span class="p">),</span>
                                     <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_colorpicker</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ColorPicker</span><span class="p">(</span><span class="n">concise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;; color:&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ct_auto_color</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;colormap&#39;</span><span class="p">),</span>
                                                  <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span> <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;200px&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_linestyle</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="s1">&#39;dashdot&#39;</span><span class="p">,</span> <span class="s1">&#39;dotted&#39;</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;; linestyle:&#39;</span><span class="p">,</span>
                                             <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span> <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_add_lvl_btn</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;Add level options. Will use default settings if no option is added&#39;</span><span class="p">,</span>
                                             <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span> <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_info_output</span> <span class="o">=</span> <span class="n">Output</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_tab</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ct_antialiased</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_if_clabel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_if_inline_clabel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_auto_color</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ct_cmap_selector</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_cmap_reverse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_num_levels_opts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_num_levels</span><span class="p">]),</span>
                                    <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ct_level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_colorpicker</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_add_lvl_btn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_method</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_linestyle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_plot_btn</span><span class="p">]),</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">ct_opts_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_info_output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_wgt_list</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">overlay</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Tab</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xlineout_tab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylineout_tab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_tab</span><span class="p">])</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">overlay</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">tt</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;x-lines&#39;</span><span class="p">,</span> <span class="s1">&#39;y-lines&#39;</span><span class="p">,</span> <span class="s1">&#39;contours&#39;</span><span class="p">])]</span>
        <span class="n">tab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overlay</span><span class="p">)</span>

        <span class="c1"># # # -------------------- Tab3 --------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colorbar</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">show_colorbar</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Show colorbar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmap_selector</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colormaps_available</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">user_cmap</span><span class="p">,</span>
                                              <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Colormap:&#39;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="ow">not</span> <span class="n">show_colorbar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmap_reverse</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Reverse&#39;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="ow">not</span> <span class="n">show_colorbar</span><span class="p">)</span>
        <span class="c1"># colorbar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_reset_cbar</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Auto&#39;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="ow">not</span> <span class="n">show_colorbar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbar</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">tex</span><span class="p">(),</span> <span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;a.u.&#39;</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                 <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Colorbar:&#39;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">if_reset_cbar</span><span class="o">.</span><span class="n">value</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">show_colorbar</span><span class="p">)</span>
        <span class="n">tab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">colorbar</span><span class="p">,</span>
                                 <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap_selector</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap_reverse</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">),</span>
                                 <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">cbar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_reset_cbar</span><span class="p">])],</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">))</span>

        <span class="c1"># # # -------------------- Tab4 --------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveas</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Save current plot&#39;</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;save current plot&#39;</span><span class="p">,</span> <span class="n">button_style</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlink</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figname</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;figure.eps&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Figure name:&#39;</span><span class="p">,</span> <span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;figure name&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedIntText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;DPI:&#39;</span><span class="p">)</span>
        <span class="n">tab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_tab_save</span><span class="p">())</span>

        <span class="c1"># # # -------------------- Tab5 --------------------------</span>
        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">figsize</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figwidth</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Width:&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figheight</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Height:&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resize_btn</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Adjust figure&#39;</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;Update figure&#39;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;refresh&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroy_fig_btn</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Close figure&#39;</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;close figure and destroy this widget&#39;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;trash&#39;</span><span class="p">)</span>
        <span class="n">tab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">figwidth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">figheight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resize_btn</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">),</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">destroy_fig_btn</span><span class="p">]))</span>

        <span class="c1"># construct the tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tab</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Tab</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="n">tab</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">tt</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tab_contents</span><span class="p">)]</span>

        <span class="c1"># plotting and then setting normalization colors</span>
<span class="c1">#         self.vmin_wgt.value, self.vlogmin_wgt.value, self.vmax_wgt.value = vmin, logvmin, vmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_main</span> <span class="o">=</span> <span class="n">output_widget</span> <span class="ow">or</span> <span class="n">Output</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observer_thrd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
<span class="c1">#         if not fig:</span>
<span class="c1">#             ax = None</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_main</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">fig</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">],</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">(</span><span class="n">vminmax_from_widget</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#             vmin, vmax = self.__get_vminmax(from_widgets=True)</span>
<span class="c1">#             self.im.set_clim(vmin, vmax)</span>
<span class="c1">#             plt.show()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlineouts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylineouts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">im2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">[]</span>

        <span class="c1"># link and activate the widgets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_reset_title</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__update_title</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_reset_xlabel</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__update_xlabel</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_reset_ylabel</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__update_ylabel</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_x_phys_unit</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_xconverter</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_y_phys_unit</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_yconverter</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_reset_cbar</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__update_cbar</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm_btn_wgt</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_norm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_vmin_auto</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__update_vmin</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_vmax_auto</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__update_vmax</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm_selector</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__update_norm_wgt</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmap_selector</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_cmap</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmap_reverse</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_cmap</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datalabel</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_title</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_show_time</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_title</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_in_phys</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_title</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlabel</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_xlabel</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ylabel</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_ylabel</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbar</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_cbar</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_range_btn</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_plot_area</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figname</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__reset_save_button</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveas</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__try_savefig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__toggle_colorbar</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resize_btn</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adjust_figure</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_xlineout_btn</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__add_xlineout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_ylineout_btn</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__add_ylineout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xananame</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__update_xanaopts</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xana_add</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__add_xana</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yananame</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__update_yanaopts</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yana_add</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__add_yana</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroy_fig_btn</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">self_destruct</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_auto_color</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_ct_auto_color_wgt_change</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_num_levels_opts</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_ct_num_lvl_opts_wgt_change</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_add_lvl_btn</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_contour_lvl_opts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_plot_btn</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_contour_plot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_if_clabel</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_clabel_toggle</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_method</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_ct_method_change</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_xrange_auto</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_xrange_step</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_yrange_auto</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_yrange_step</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">widgets_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_main</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_main</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">get_dataname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">get_time_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">convert_tunit</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">osh5vis</span><span class="o">.</span><span class="n">time_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">run_attrs</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">run_attrs</span><span class="p">[</span><span class="s1">&#39;TIME UNITS&#39;</span><span class="p">],</span> <span class="n">convert_tunit</span><span class="o">=</span><span class="n">convert_tunit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">slcs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span> <span class="n">slcs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xlabel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylabel</span> <span class="o">=</span> <span class="n">osh5vis</span><span class="o">.</span><span class="n">axis_format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">long_name</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">),</span> \
                                     <span class="n">osh5vis</span><span class="o">.</span><span class="n">axis_format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">long_name</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_title</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_xlabel</span><span class="p">({</span><span class="s1">&#39;new&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_ylabel</span><span class="p">({</span><span class="s1">&#39;new&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">reset_plot_area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_min_wgt</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_max_wgt</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">xstep</span><span class="p">,</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">y_min_wgt</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max_wgt</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">ystep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_xy_minmax_delta</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_min_wgt</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_max_wgt</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min_wgt</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">x_min_wgt</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_max_wgt</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min_wgt</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max_wgt</span><span class="o">.</span><span class="n">max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_step_wgt</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_step_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">xstep</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ystep</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__destroy_all_xlineout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__destroy_all_ylineout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ct_destroy_all</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">redraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">update_vminmax</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">newfile</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># set new extent if necessary</span>
        <span class="k">if</span> <span class="n">newfile</span><span class="p">:</span>
            <span class="n">no_need_to_update</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">),</span>
                                            <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">))</span>
            <span class="n">no_need_to_update</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pltfunc</span> <span class="ow">is</span> <span class="n">osh5vis</span><span class="o">.</span><span class="n">osimshow</span><span class="p">:</span>
            <span class="s2">&quot;if the size of the data is the same we can just redraw part of figure&quot;</span>
            <span class="n">processed_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">])</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">processed_data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">newfile</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">no_need_to_update</span><span class="p">):</span>
                <span class="n">xvmm</span><span class="p">,</span> <span class="n">yvmm</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_xrange_auto</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xbound</span><span class="p">(),</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_yrange_auto</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ybound</span><span class="p">()</span>
                <span class="n">xmm</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ymm</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">osh5vis</span><span class="o">.</span><span class="n">get_extent_and_unit</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">],</span> <span class="n">convert_xaxis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">if_x_phys_unit</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">convert_yaxis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">if_y_phys_unit</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="n">Generic2DPlotCtrl</span><span class="o">.</span><span class="n">update_axis_units</span><span class="p">(</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">xmm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xmm</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ymm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ymm</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">xconv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">,</span> <span class="n">yconv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xbound</span><span class="p">(</span><span class="n">xmm</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ybound</span><span class="p">(</span><span class="n">ymm</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">push_current</span><span class="p">()</span>
                <span class="c1"># zoom-in, back to previous view</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xbound</span><span class="p">(</span><span class="n">xvmm</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ybound</span><span class="p">(</span><span class="n">yvmm</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">update_vminmax</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__handle_lognorm</span><span class="p">()</span>
                <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_vminmax</span><span class="p">(</span><span class="n">from_widgets</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#                 vmin = np.min(processed_data) if self.if_vmin_auto.value else None</span>
<span class="c1">#                 vmax = np.max(processed_data) if self.if_vmax_auto.value else None</span>
<span class="c1">#                 if vmin is not None:</span>
<span class="c1">#                     self.current_vmin = vmin</span>
<span class="c1">#                 if vmax is not None:</span>
<span class="c1">#                     self.vmax_wgt.value = vmax</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">set_clim</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="s2">&quot;for contour/contourf we have to do a full replot&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_replot_contour</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_replot_contour</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>
            <span class="n">col</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replot_axes</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">update_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_plot_title</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">update_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">update_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">update_cbar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">update_cmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_change</span><span class="p">):</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap_selector</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap_reverse</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap_selector</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="s1">&#39;_r&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>

<span class="c1">#     def update_time_label(self):</span>
<span class="c1">#         self._time = osh5vis.time_format(self._data.run_attrs[&#39;TIME&#39;][0], self._data.run_attrs[&#39;TIME UNITS&#39;])</span>

    <span class="k">def</span> <span class="nf">adjust_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_main</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out_main</span><span class="o">.</span><span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># this dosen&#39;t work in all scenarios. it could be a bug in matplotlib/jupyterlab</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figwidth</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">figheight</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">register_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">others</span><span class="p">):</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">others</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">others</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">others</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">replot_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="c1">#         self.fig.delaxes(self.ax)</span>
<span class="c1"># #         self.fig.clear()</span>
<span class="c1">#         self.ax = self.fig.add_subplot(111)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
<span class="c1">#         self.im.remove()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="o">=</span> <span class="n">cb</span>
<span class="c1">#         self.fig.subplots_adjust()  # does not compatible with constrained_layout in Matplotlib 3.0</span>

    <span class="k">def</span> <span class="nf">__get_xy_minmax_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="c1">#         return (float(&#39;%.2g&#39; % self._data.axes[1].min), float(&#39;%.2g&#39; % self._data.axes[1].ax.max()), float(&#39;%.2g&#39; % self._data.axes[1].increment),</span>
<span class="c1">#                 float(&#39;%.2g&#39; % self._data.axes[0].min), float(&#39;%.2g&#39; % self._data.axes[0].ax.max()), float(&#39;%.2g&#39; % self._data.axes[0].increment))</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">increment</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">increment</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_xy_minmaxstep_wgt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xstep</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ystep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_xy_minmax_delta</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;x&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_min_wgt</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_max_wgt</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_step_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">xmin</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">,</span> <span class="n">xstep</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_min_wgt</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_max_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_min_wgt</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_max_wgt</span><span class="o">.</span><span class="n">max</span>
        <span class="k">if</span> <span class="s1">&#39;y&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_min_wgt</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max_wgt</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_step_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">ymin</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">,</span> <span class="n">ystep</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_min_wgt</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min_wgt</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max_wgt</span><span class="o">.</span><span class="n">max</span>

    <span class="k">def</span> <span class="nf">reset_xrange_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_xy_minmaxstep_wgt</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reset_yrange_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_xy_minmaxstep_wgt</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_plot_area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="n">bnd</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_min_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_step_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">),</span>
               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_min_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_max_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_step_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get_index_slice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bd</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bd</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bnd</span><span class="p">))</span>
        <span class="c1">#TODO: maybe we can keep some of the overlaid plots but replot_axes will generate new axes.</span>
        <span class="c1"># for now delete everything for simplicity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__destroy_all_xlineout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__destroy_all_ylineout</span><span class="p">()</span>
<span class="c1">#         self._ct_destroy_all()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replot_axes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_contours</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">refresh_tab_wgt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the tab.children is a tuple so we have to reconstruct the whole tab widget when</span>
<span class="sd">        addition/deletion of children widgets happens</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="o">.</span><span class="n">children</span>
        <span class="n">newtab</span> <span class="o">=</span> <span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span> <span class="k">else</span> <span class="n">t</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">update_list</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">newtab</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">current_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vminmax_from_widget</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_selector</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">__get_norm</span><span class="p">(</span><span class="n">vminmax_from_widget</span><span class="o">=</span><span class="n">vminmax_from_widget</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">plot_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vminmax_from_widget</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">passthrough</span><span class="p">):</span>
        <span class="n">ifcolorbar</span> <span class="o">=</span> <span class="n">passthrough</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;colorbar&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pltfunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__pp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">]),</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap_selector</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                            <span class="n">norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_norm</span><span class="p">(</span><span class="n">vminmax_from_widget</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_plot_title</span><span class="p">(),</span>
                            <span class="n">xlabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xlabel</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ylabel</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">cblabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cbar</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                            <span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="n">ifcolorbar</span><span class="p">,</span>
                            <span class="n">convert_xaxis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">if_x_phys_unit</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">convert_yaxis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">if_y_phys_unit</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">passthrough</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">self_destruct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets_list</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onDestruction</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_plot_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datalabel</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datalabel</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="p">((</span><span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_time_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_in_phys</span><span class="o">.</span><span class="n">value</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_show_time</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_time_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_in_phys</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_show_time</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">get_tab_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">norm_selector</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_selector</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_btn_wgt</span><span class="p">,</span>
                             <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">datalabel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_reset_title</span><span class="p">]),</span>
                                           <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">if_show_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_in_phys</span><span class="p">])])])</span>

    <span class="k">def</span> <span class="nf">get_tab_save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">figname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveas</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">),</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">dlink</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">extract_lineout_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="c1"># we put all params in the tooltip of the delete button</span>
        <span class="k">if</span> <span class="s2">&quot;~&quot;</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>  <span class="c1"># this is analysis</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="n">l</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_lineouts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">description_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">xconv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yconv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># update x lineouts/analysis</span>
        <span class="k">if</span> <span class="s1">&#39;x&#39;</span> <span class="ow">in</span> <span class="n">dim</span><span class="p">:</span>
            <span class="n">vminl</span><span class="p">,</span> <span class="n">vmaxl</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="n">xaxis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">]</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ax</span>
            <span class="k">for</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlineout_list_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">cpk</span><span class="p">,</span> <span class="n">nw</span> <span class="o">=</span> <span class="n">wgt</span><span class="o">.</span><span class="n">children</span>
                <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_lineout_params</span><span class="p">(</span><span class="n">nw</span><span class="o">.</span><span class="n">tooltip</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">,</span> <span class="n">posstr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_xana_data_descr</span><span class="p">(</span><span class="o">*</span><span class="n">params</span><span class="p">,</span> <span class="n">description_only</span><span class="o">=</span><span class="n">description_only</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">,</span> <span class="n">posstr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_xlineout_data_and_index</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">cpk</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">posstr</span>
                <span class="k">if</span> <span class="n">description_only</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xlineouts</span><span class="p">[</span><span class="n">cpk</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">vminl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">vmaxl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">xconv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_xlineouts</span><span class="p">[</span><span class="n">cpk</span><span class="p">]</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span><span class="n">xconv</span> <span class="o">*</span> <span class="n">xaxis</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">description_only</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlineout_list_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_vminmax</span><span class="p">()</span>
                <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmin</span> <span class="k">if</span> <span class="n">vmin</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">vminl</span><span class="p">),</span> <span class="n">vmax</span> <span class="k">if</span> <span class="n">vmax</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">vmaxl</span><span class="p">)</span>
                <span class="n">padding</span> <span class="o">=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="p">(</span><span class="n">vmax</span> <span class="o">-</span> <span class="n">vmin</span><span class="p">)</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bottom&#39;</span><span class="p">:</span> <span class="n">vmin</span> <span class="o">-</span> <span class="n">padding</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">:</span> <span class="n">vmax</span> <span class="o">+</span> <span class="n">padding</span><span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axx</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="c1"># update y lineouts/analysis</span>
        <span class="k">if</span> <span class="s1">&#39;y&#39;</span> <span class="ow">in</span> <span class="n">dim</span><span class="p">:</span>
            <span class="n">vminl</span><span class="p">,</span> <span class="n">vmaxl</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="n">yaxis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">]</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ax</span>
            <span class="k">for</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylineout_list_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">cpk</span><span class="p">,</span> <span class="n">nw</span> <span class="o">=</span> <span class="n">wgt</span><span class="o">.</span><span class="n">children</span>
                <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_lineout_params</span><span class="p">(</span><span class="n">nw</span><span class="o">.</span><span class="n">tooltip</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">,</span> <span class="n">posstr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_yana_data_descr</span><span class="p">(</span><span class="o">*</span><span class="n">params</span><span class="p">,</span> <span class="n">description_only</span><span class="o">=</span><span class="n">description_only</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">,</span> <span class="n">posstr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ylineout_data_and_index</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">cpk</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">posstr</span>
                <span class="k">if</span> <span class="n">description_only</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ylineouts</span><span class="p">[</span><span class="n">cpk</span><span class="p">]</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">vminl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">vmaxl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">yconv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_ylineouts</span><span class="p">[</span><span class="n">cpk</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">yconv</span> <span class="o">*</span> <span class="n">yaxis</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">description_only</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylineout_list_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_vminmax</span><span class="p">()</span>
                <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmin</span> <span class="k">if</span> <span class="n">vmin</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">vminl</span><span class="p">),</span> <span class="n">vmax</span> <span class="k">if</span> <span class="n">vmax</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">vmaxl</span><span class="p">)</span>
                <span class="n">padding</span> <span class="o">=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="p">(</span><span class="n">vmax</span> <span class="o">-</span> <span class="n">vmin</span><span class="p">)</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="n">vmin</span> <span class="o">-</span> <span class="n">padding</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="n">vmax</span> <span class="o">+</span> <span class="n">padding</span><span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axy</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_contours</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_wgt_list</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">db</span> <span class="o">=</span> <span class="n">wgt</span><span class="o">.</span><span class="n">children</span>
            <span class="n">w</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_plot_dict</span><span class="p">[</span><span class="n">db</span><span class="p">]</span>
            <span class="c1"># reconstruct the contour</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">im2</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
            <span class="c1"># free up resources</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">im</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">im</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="c1"># _ct_plot will append im2 with the new plot</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ct_plot</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tmp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ct_plot_dict</span><span class="p">[</span><span class="n">db</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">im2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_on_clabel_toggle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_if_inline_clabel</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">update_axis_units</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">thisclass</span><span class="p">,</span> <span class="n">ext</span><span class="p">,</span> <span class="n">xconv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yconv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xunit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yunit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xconv_now</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yconv_now</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">xconv_now</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">thisclass</span><span class="o">.</span><span class="n">xconv</span> <span class="o">=</span> <span class="n">xconv_now</span>
        <span class="k">if</span> <span class="n">yconv_now</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">thisclass</span><span class="o">.</span><span class="n">yconv</span> <span class="o">=</span> <span class="n">yconv_now</span>
        <span class="n">thisclass</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
        <span class="c1">#TODO: contour/contourf do not have set_extent?? Have to reconstruct from scratch</span>
        <span class="n">thisclass</span><span class="o">.</span><span class="n">update_contours</span><span class="p">()</span>
        <span class="n">thisclass</span><span class="o">.</span><span class="n">_update_xy_minmaxstep_wgt</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="n">dim</span><span class="p">)</span>
        <span class="n">thisclass</span><span class="o">.</span><span class="n">update_lineouts</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">xconv</span><span class="o">=</span><span class="n">xconv</span><span class="p">,</span> <span class="n">yconv</span><span class="o">=</span><span class="n">yconv</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;x&#39;</span> <span class="ow">in</span> <span class="n">dim</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">thisclass</span><span class="o">.</span><span class="n">if_reset_xlabel</span><span class="o">.</span><span class="n">value</span> <span class="ow">and</span> <span class="n">xunit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">thisclass</span><span class="o">.</span><span class="n">_xlabel</span> <span class="o">=</span> <span class="n">osh5vis</span><span class="o">.</span><span class="n">axis_format</span><span class="p">(</span><span class="n">thisclass</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">long_name</span><span class="p">,</span> <span class="n">xunit</span><span class="p">)</span>
                <span class="c1"># toggle the reset checkbox</span>
                <span class="n">thisclass</span><span class="o">.</span><span class="n">if_reset_xlabel</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">thisclass</span><span class="o">.</span><span class="n">if_reset_xlabel</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s1">&#39;y&#39;</span> <span class="ow">in</span> <span class="n">dim</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">thisclass</span><span class="o">.</span><span class="n">if_reset_ylabel</span><span class="o">.</span><span class="n">value</span> <span class="ow">and</span> <span class="n">yunit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">thisclass</span><span class="o">.</span><span class="n">_ylabel</span> <span class="o">=</span> <span class="n">osh5vis</span><span class="o">.</span><span class="n">axis_format</span><span class="p">(</span><span class="n">thisclass</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">long_name</span><span class="p">,</span> <span class="n">yunit</span><span class="p">)</span>
                <span class="c1"># toggle the reset checkbox</span>
                <span class="n">thisclass</span><span class="o">.</span><span class="n">if_reset_ylabel</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">thisclass</span><span class="o">.</span><span class="n">if_reset_ylabel</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_extent_and_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">osh5vis</span><span class="o">.</span><span class="n">get_extent_and_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">],</span> <span class="n">convert_xaxis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">if_x_phys_unit</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">convert_yaxis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">if_y_phys_unit</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_xconverter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="c1">#TODO: In general handling share axes this way is combersome. Maybe we should shift all controls to MultiPanelCtrl.</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]:</span>
            <span class="n">xconv</span><span class="p">,</span> <span class="n">xunit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">punit_convert_factor</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xconv</span><span class="p">,</span> <span class="n">xunit</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
        <span class="k">if</span> <span class="n">xconv</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">,</span> <span class="n">xconv</span> <span class="o">=</span> <span class="n">xconv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span>
            <span class="n">xconv</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">xconv</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span> <span class="o">==</span> <span class="mf">1.0</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span>
        <span class="n">xmm</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ymm</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_extent_and_unit</span><span class="p">()</span>
        <span class="n">xvmm</span><span class="p">,</span> <span class="n">yvmm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xbound</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ybound</span><span class="p">()</span>
        <span class="c1"># set new extent, zoom out to full scale, update it as the &quot;home view&quot;</span>
        <span class="c1">#TODO: there might be finer control over the view if we dig deeper into matplotlib interactive backend</span>
        <span class="c1">#      but I don&#39;t know how stable those APIs are.</span>
        <span class="n">Generic2DPlotCtrl</span><span class="o">.</span><span class="n">update_axis_units</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">xmm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xmm</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ymm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ymm</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">xconv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">,</span> <span class="n">xunit</span><span class="o">=</span><span class="n">xunit</span><span class="p">)</span>
        <span class="n">sharedx</span><span class="p">,</span> <span class="n">sharedy</span><span class="p">,</span> <span class="n">not_shared</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sharedx&#39;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sharedy&#39;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">()),</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sharedx</span><span class="p">):</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">oymm</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">get_extent_and_unit</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">w</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sharedy</span><span class="p">:</span>
                <span class="n">not_shared</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ybound</span><span class="p">()))</span>
                <span class="n">w</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ybound</span><span class="p">(</span><span class="n">oymm</span><span class="p">)</span>
            <span class="n">Generic2DPlotCtrl</span><span class="o">.</span><span class="n">update_axis_units</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="p">(</span><span class="n">xmm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xmm</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">oymm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oymm</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">xconv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">,</span> <span class="n">xunit</span><span class="o">=</span><span class="n">xunit</span><span class="p">,</span> <span class="n">xconv_now</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">if_x_phys_unit</span><span class="o">.</span><span class="n">unobserve</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">_update_xconverter</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">if_x_phys_unit</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span>
            <span class="n">w</span><span class="o">.</span><span class="n">if_x_phys_unit</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">_update_xconverter</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xbound</span><span class="p">(</span><span class="n">xmm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ybound</span><span class="p">(</span><span class="n">ymm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">push_current</span><span class="p">()</span>
        <span class="c1"># zoom-in, back to previous view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xbound</span><span class="p">((</span><span class="n">xvmm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">xconv</span><span class="p">,</span> <span class="n">xvmm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">xconv</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ybound</span><span class="p">(</span><span class="n">yvmm</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">not_shared</span><span class="p">:</span>
            <span class="n">sharedx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ybound</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_yconverter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]:</span>
            <span class="n">yconv</span><span class="p">,</span> <span class="n">yunit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">punit_convert_factor</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yconv</span><span class="p">,</span> <span class="n">yunit</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
        <span class="k">if</span> <span class="n">yconv</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">,</span> <span class="n">yconv</span> <span class="o">=</span> <span class="n">yconv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span>
            <span class="n">yconv</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">yconv</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span> <span class="o">==</span> <span class="mf">1.0</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">]</span>
        <span class="n">xmm</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ymm</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_extent_and_unit</span><span class="p">()</span>
        <span class="n">xvmm</span><span class="p">,</span> <span class="n">yvmm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xbound</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ybound</span><span class="p">()</span>
        <span class="n">Generic2DPlotCtrl</span><span class="o">.</span><span class="n">update_axis_units</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">xmm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xmm</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ymm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ymm</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">yconv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">,</span> <span class="n">yunit</span><span class="o">=</span><span class="n">yunit</span><span class="p">)</span>
        <span class="n">sharedx</span><span class="p">,</span> <span class="n">sharedy</span><span class="p">,</span> <span class="n">not_shared</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sharedx&#39;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sharedy&#39;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">()),</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sharedy</span><span class="p">):</span>
            <span class="n">oxmm</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">get_extent_and_unit</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">w</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sharedx</span><span class="p">:</span>
                <span class="n">not_shared</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xbound</span><span class="p">()))</span>
                <span class="n">w</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xbound</span><span class="p">(</span><span class="n">oxvmm</span><span class="p">)</span>
            <span class="n">Generic2DPlotCtrl</span><span class="o">.</span><span class="n">update_axis_units</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="p">(</span><span class="n">oxmm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oxmm</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ymm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ymm</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">yconv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">,</span> <span class="n">yunit</span><span class="o">=</span><span class="n">yunit</span><span class="p">,</span> <span class="n">yconv_now</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">if_y_phys_unit</span><span class="o">.</span><span class="n">unobserve</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">_update_yconverter</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">if_y_phys_unit</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span>
            <span class="n">w</span><span class="o">.</span><span class="n">if_y_phys_unit</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">_update_yconverter</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xbound</span><span class="p">(</span><span class="n">xmm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ybound</span><span class="p">(</span><span class="n">ymm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">push_current</span><span class="p">()</span>
        <span class="c1"># zoom-in, back to previous view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ybound</span><span class="p">((</span><span class="n">yvmm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">yconv</span><span class="p">,</span> <span class="n">yvmm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">yconv</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xbound</span><span class="p">(</span><span class="n">xvmm</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">not_shared</span><span class="p">:</span>
            <span class="n">sharedy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xbound</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_ct_auto_color_wgt_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;colormap&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ct_cmap_selector</span><span class="o">.</span><span class="n">disabled</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_colorpicker</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ct_cmap_selector</span><span class="o">.</span><span class="n">disabled</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_colorpicker</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_on_ct_method_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="c1"># linestyle keyword only applies to contour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_linestyle</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;contour&#39;</span>

    <span class="k">def</span> <span class="nf">_on_ct_num_lvl_opts_wgt_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_num_levels</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;fixed:&#39;</span> <span class="k">else</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_level</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;option&#39;</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_get_contour_opt_wgt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lvl</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">txt_wgt_width</span><span class="o">=</span><span class="s1">&#39;initial&#39;</span><span class="p">,</span> <span class="n">cp_wgt_width</span><span class="o">=</span><span class="s1">&#39;initial&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">lvl</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;level=&#39;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ct_num_levels_opts</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="s1">&#39;option&#39;</span><span class="p">),</span>
                                  <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span> <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="n">txt_wgt_width</span><span class="p">}),</span>
                <span class="n">widgets</span><span class="o">.</span><span class="n">ColorPicker</span><span class="p">(</span><span class="n">concise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;; color:&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ct_auto_color</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;colormap&#39;</span><span class="p">),</span>
                                    <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span> <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="n">cp_wgt_width</span><span class="p">}),</span> <span class="n">_get_delete_btn</span><span class="p">(</span><span class="s1">&#39;level </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">lvl</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_remove_ct_lvl_opt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">btn</span><span class="p">):</span>
        <span class="n">lvl_wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_opts_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">btn</span><span class="p">)</span>
        <span class="c1"># remove level widgets from ct_opts_list</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ct_opts_list</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="n">tmp</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">lvl_wgt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_opts_list</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
        <span class="n">lvl_wgt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_print_ct_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_info_output</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ct_info_output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_extract_ct_kwargs_from_wgt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">levels</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_opts_list</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">lvl</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">db</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">children</span>
            <span class="n">levels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lvl</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">lvl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">cp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">w</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;antialiased&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_antialiased</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_auto_color</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;colormap&#39;</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_cmap_selector</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;_r&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_cmap_reverse</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_selector</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">__get_norm</span><span class="p">())</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_auto_color</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;manual&#39;</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colors</span> <span class="ow">or</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">colors</span> <span class="k">else</span> <span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_linestyle</span><span class="o">.</span><span class="n">disabled</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linestyles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_linestyle</span><span class="o">.</span><span class="n">value</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_num_levels_opts</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;fixed:&#39;</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_num_levels</span><span class="o">.</span><span class="n">value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_num_levels_opts</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;option&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">levels</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">levels</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_auto_color</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;manual&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_print_ct_info</span><span class="p">(</span><span class="s1">&#39;Found duplicated levels, last appearance takes precedence&#39;</span><span class="p">)</span>
                        <span class="n">tmp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">levels</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]))</span>  <span class="c1"># use dict to get rid of duplicates</span>
                        <span class="n">levels</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">list</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">levels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">levels</span><span class="p">))</span>  <span class="c1"># use dict to get rid of duplicates</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ii</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">levels</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">levels</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ii</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_print_ct_info</span><span class="p">(</span><span class="s1">&#39;number of levels = option: but no option is added, fall back to auto&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_auto_color</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;colormap&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_num_levels_opts</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_opts_list</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print_ct_info</span><span class="p">(</span><span class="s1">&#39;Level options have no effect.&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">kwargs</span>

    <span class="k">def</span> <span class="nf">_ct_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pltfunc</span><span class="p">,</span> <span class="n">if_clabel</span><span class="p">,</span> <span class="n">if_inline_clabel</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">vext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">get_extent</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>  <span class="c1"># this is called to replot for new data, kwargs contain all necessary info to generate the contour, kwargs will be altered</span>
            <span class="n">pltfunc</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;contour&#39;</span><span class="p">)</span>
            <span class="n">if_clabel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;if_clabel&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_if_clabel</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">if_inline_clabel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;inline&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_if_inline_clabel</span><span class="p">)</span> <span class="ow">and</span> <span class="n">if_clabel</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># this is called when user press the plot button, kwargs will return keywords for the contour plot</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extract_ct_kwargs_from_wgt</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">pltfunc</span> <span class="o">==</span> <span class="s1">&#39;contour&#39;</span><span class="p">:</span>
            <span class="n">im2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">osh5vis</span><span class="o">.</span><span class="n">oscontour</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__pp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">]),</span> <span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                       <span class="n">convert_xaxis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">if_x_phys_unit</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">convert_yaxis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">if_y_phys_unit</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                       <span class="n">xlabel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">im2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">osh5vis</span><span class="o">.</span><span class="n">oscontourf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__pp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">]),</span> <span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                        <span class="n">convert_xaxis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">if_x_phys_unit</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">convert_yaxis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">if_y_phys_unit</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                        <span class="n">xlabel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">im2</span><span class="o">.</span><span class="n">levels</span>
        <span class="c1"># have to set_alpha after the plot, otherwise alpha value cannot be updated later (not sure why)</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">im2</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="k">if</span> <span class="n">if_clabel</span><span class="p">:</span>
            <span class="n">cl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">im2</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span> <span class="n">use_clabeltext</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="n">if_inline_clabel</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cl</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">im2</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">im2</span><span class="p">,</span> <span class="n">cl</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">vext</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">kwargs</span>

    <span class="k">def</span> <span class="nf">_ct_clear_lvl_opts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_opts_list</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">opt</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">w</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_opts_list</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_ct_delete_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">btn</span><span class="p">):</span>
        <span class="n">wgt</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_plot_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">btn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_plot_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">wgt</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># remove the alpha key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">im2</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">im</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">im</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ct_wgt_list</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="n">tmp</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">wgt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_wgt_list</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">wgt</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">wgt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_ct_set_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="p">,</span> <span class="n">im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_plot_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ct_plot_dict</span><span class="p">[</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;owner&#39;</span><span class="p">]]][</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
        <span class="n">im</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">])</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_add_contour_plot_wgt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">identifier</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;Levels=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;; &#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span> <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;opacity:&#39;</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                         <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span> <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;120px&#39;</span><span class="p">})</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">_get_delete_btn</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">])</span>
        <span class="n">db</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ct_delete_plot</span><span class="p">)</span>
        <span class="n">alpha</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ct_set_alpha</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>

        <span class="n">wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="n">identifier</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">db</span><span class="p">],</span>  <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">border</span><span class="o">=</span><span class="s1">&#39;solid 1px&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_plot_dict</span><span class="p">[</span><span class="n">db</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wgt</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">im2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_plot_dict</span><span class="p">[</span><span class="n">alpha</span><span class="p">]</span> <span class="o">=</span> <span class="n">db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_wgt_list</span><span class="o">.</span><span class="n">children</span> <span class="o">+=</span> <span class="p">(</span><span class="n">wgt</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">_add_contour_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ct_plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ct_method</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_if_clabel</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_if_inline_clabel</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">{})</span>
        <span class="c1"># save clabel kwargs for replotting</span>
        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;if_clabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_if_clabel</span><span class="o">.</span><span class="n">value</span>
        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;inline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_if_inline_clabel</span><span class="o">.</span><span class="n">value</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_if_clabel</span>
        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_method</span><span class="o">.</span><span class="n">value</span>
        <span class="c1"># clear the level options in the output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ct_clear_lvl_opts</span><span class="p">()</span>
        <span class="c1"># add a widgets to handle further interaction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_contour_plot_wgt</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ct_destroy_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># close all widgets</span>
        <span class="k">for</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_wgt_list</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">wgt</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">w</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_wgt_list</span><span class="o">.</span><span class="n">children</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_plot_dict</span> <span class="o">=</span> <span class="p">(),</span> <span class="p">{}</span>
        <span class="c1"># remove all contours</span>
        <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">im2</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">im</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">im</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">im2</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_get_level_added</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">lvl_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">lvl_wgt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_opts_list</span><span class="o">.</span><span class="n">children</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_add_one_ct_lvl_opt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lvl</span><span class="p">,</span> <span class="n">co</span><span class="p">):</span>
        <span class="n">lvl</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_contour_opt_wgt</span><span class="p">(</span><span class="n">lvl</span><span class="p">,</span> <span class="n">co</span><span class="p">,</span> <span class="s1">&#39;100px&#39;</span><span class="p">,</span> <span class="s1">&#39;150px&#39;</span><span class="p">)</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="n">lvl</span><span class="p">,</span> <span class="s1">&#39;disabled&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ct_level</span><span class="p">,</span> <span class="s1">&#39;disabled&#39;</span><span class="p">))</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="n">cp</span><span class="p">,</span> <span class="s1">&#39;disabled&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ct_colorpicker</span><span class="p">,</span> <span class="s1">&#39;disabled&#39;</span><span class="p">))</span>
        <span class="n">db</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_remove_ct_lvl_opt</span><span class="p">)</span>
        <span class="n">lvl_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="n">lvl</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">db</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">border</span><span class="o">=</span><span class="s1">&#39;solid 1px&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_opts_dict</span><span class="p">[</span><span class="n">db</span><span class="p">]</span> <span class="o">=</span> <span class="n">lvl_wgt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct_opts_list</span><span class="o">.</span><span class="n">children</span> <span class="o">+=</span> <span class="p">(</span><span class="n">lvl_wgt</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">_add_contour_lvl_opts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="n">level_list</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;\s*,\s*|\s+|\s*;\s*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_level</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lvl</span> <span class="ow">in</span> <span class="n">level_list</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">lv</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lvl</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_one_ct_lvl_opt</span><span class="p">(</span><span class="n">lv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct_colorpicker</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__update_xanaopts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__analysis_def</span><span class="p">[</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]]</span>
        <span class="n">optlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">opts</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xanaopts</span><span class="o">.</span><span class="n">options</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xanaopts</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">optlist</span><span class="p">,</span> <span class="n">optlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_xana_data_descr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">description_only</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__analysis_def</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">opts</span><span class="p">]</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">]</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">start</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">]</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">end</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span>
        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">description_only</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pp</span><span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">posstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">~</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="s1">&#39;ix= &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; ~ &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">end</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">opts</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">name</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">posstr</span><span class="p">,</span> <span class="n">tp</span>

    <span class="k">def</span> <span class="nf">__add_xana</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">label2int</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">anaxmin</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">label2int</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">anaxmax</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">posstr</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_xana_data_descr</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xanaopts</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xananame</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__add_xline</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">posstr</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="mi">240</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__update_yanaopts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__analysis_def</span><span class="p">[</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]]</span>
        <span class="n">optlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yanaopts</span><span class="o">.</span><span class="n">options</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yanaopts</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">optlist</span><span class="p">,</span> <span class="n">optlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_yana_data_descr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">description_only</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__analysis_def</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">opts</span><span class="p">]</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">]</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">start</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">]</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">end</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span>
        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">description_only</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pp</span><span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">][:,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">posstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">~</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="s1">&#39;iy= &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; ~ &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">end</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">opts</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">name</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">posstr</span><span class="p">,</span> <span class="n">tp</span>

    <span class="k">def</span> <span class="nf">__add_yana</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">label2int</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">anaymin</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">label2int</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">anaymax</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">posstr</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_yana_data_descr</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yanaopts</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yananame</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__add_yline</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">posstr</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="mi">240</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__update_twinx_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_selector</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">LogNorm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axx</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_selector</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">SymLogNorm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axx</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;symlog&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axx</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__destroy_all_xlineout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlineouts</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlineout_list_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="c1"># remove lineout</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xlineouts</span><span class="p">[</span><span class="n">li</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                <span class="c1"># remove widget</span>
                <span class="n">li</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="c1"># unregister all widgets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xlineouts</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xlineout_list_wgt</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
            <span class="c1"># remove axes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axx</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__remove_xlineout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">btn</span><span class="p">):</span>
        <span class="c1"># unregister widget</span>
        <span class="n">xlineout_wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlineouts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">btn</span><span class="p">)</span>
        <span class="n">xlineout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlineouts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">xlineout_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># remove x lineout</span>
        <span class="n">xlineout</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="c1"># remove x lineout item widgets</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlineout_list_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="n">tmp</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">xlineout_wgt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlineout_list_wgt</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
        <span class="n">xlineout_wgt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1"># remove axes if all lineout is deleted</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlineouts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axx</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
<span class="c1">#         #TODO: a walkaround for a strange behavior of constrained_layout</span>

    <span class="k">def</span> <span class="nf">__set_xlineout_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xlineouts</span><span class="p">[</span><span class="n">color</span><span class="p">[</span><span class="s1">&#39;owner&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__add_xline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">descr</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">wgt_width</span><span class="p">):</span>
        <span class="c1"># add twinx if not exist</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlineouts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__update_twinx_scale</span><span class="p">()</span>
        <span class="c1"># plot</span>
        <span class="n">xlim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="n">xlineout</span> <span class="o">=</span> <span class="n">osh5vis</span><span class="o">.</span><span class="n">osplot1d</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">convert_xaxis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">if_x_phys_unit</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axx</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># add widgets (color picker + delete button)</span>
        <span class="n">nw</span> <span class="o">=</span> <span class="n">_get_delete_btn</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span>
        <span class="n">nw</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__remove_xlineout</span><span class="p">)</span>
        <span class="n">co</span> <span class="o">=</span> <span class="n">xlineout</span><span class="o">.</span><span class="n">get_color</span><span class="p">()</span>
        <span class="n">cpk</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ColorPicker</span><span class="p">(</span><span class="n">concise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">descr</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">co</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span>
                                  <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">px&#39;</span> <span class="o">%</span> <span class="n">wgt_width</span><span class="p">))</span>
        <span class="n">cpk</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__set_xlineout_color</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="n">lineout_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="n">cpk</span><span class="p">,</span> <span class="n">nw</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">px&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wgt_width</span> <span class="o">+</span> <span class="mi">50</span><span class="p">),</span> <span class="n">border</span><span class="o">=</span><span class="s1">&#39;solid 1px&#39;</span><span class="p">,</span> <span class="n">flex</span><span class="o">=</span><span class="s1">&#39;0 0 auto&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlineout_list_wgt</span><span class="o">.</span><span class="n">children</span> <span class="o">+=</span> <span class="p">(</span><span class="n">lineout_wgt</span><span class="p">,)</span>
        <span class="c1"># register a new lineout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xlineouts</span><span class="p">[</span><span class="n">nw</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlineouts</span><span class="p">[</span><span class="n">cpk</span><span class="p">]</span> <span class="o">=</span> <span class="n">lineout_wgt</span><span class="p">,</span> <span class="n">xlineout</span>

    <span class="k">def</span> <span class="nf">get_xlineout_data_and_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">label2int</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">loc</span><span class="p">)</span>
        <span class="n">posstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">pos</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">pos</span><span class="p">,</span> <span class="p">:][</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">posstr</span><span class="p">,</span> <span class="n">pos</span>

    <span class="k">def</span> <span class="nf">__add_xlineout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">posstr</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_xlineout_data_and_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlineout_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">yconv</span><span class="p">)</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">pos</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; lineout&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__add_xline</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">posstr</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="mi">170</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__update_xlineout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlineouts</span><span class="p">:</span>
<span class="c1">#             for k, v in self._xlineouts.items():</span>
<span class="c1">#                 if hasattr(v, &#39;set_ydata&#39;):</span>
<span class="c1">#                     v.set_ydata(self.__pp(v.get_ydata()))</span>
<span class="c1">#             for wgt in self.xlineout_list_wgt.children:</span>
<span class="c1">#                 pos = float(wgt.children[0].description)</span>
<span class="c1">#                 self._xlineouts[wgt.children[0]].set_ydata(self.__pp(self._data[self._slcs].loc[pos, :]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__update_twinx_scale</span><span class="p">()</span>
            <span class="c1">#TODO: autoscale for &#39;log&#39; scale doesn&#39;t work after plotting the line, we have to do it manually</span>
            <span class="c1">#TDDO: a walkaround for a strange behavior of constrained_layout, should be removed in the future</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__update_twiny_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_selector</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">LogNorm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axy</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_selector</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">SymLogNorm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axy</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;symlog&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axy</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__destroy_all_ylineout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylineouts</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylineout_list_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="c1"># remove lineout</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ylineouts</span><span class="p">[</span><span class="n">li</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                <span class="c1"># remove widget</span>
                <span class="n">li</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="c1"># unregister all widgets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ylineouts</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ylineout_list_wgt</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
            <span class="c1"># remove axes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axy</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__remove_ylineout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">btn</span><span class="p">):</span>
        <span class="c1"># unregister widget</span>
        <span class="n">ylineout_wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylineouts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">btn</span><span class="p">)</span>
        <span class="n">ylineout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylineouts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">ylineout_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># remove x lineout</span>
        <span class="n">ylineout</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="c1"># remove x lineout item widgets</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylineout_list_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="n">tmp</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ylineout_wgt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ylineout_list_wgt</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
        <span class="n">ylineout_wgt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1"># remove axes if all lineout is deleted</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylineouts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axy</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__set_ylineout_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ylineouts</span><span class="p">[</span><span class="n">color</span><span class="p">[</span><span class="s1">&#39;owner&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__add_yline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">descr</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">wgt_width</span><span class="p">):</span>
        <span class="c1"># add twinx if not exist</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylineouts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__update_twiny_scale</span><span class="p">()</span>
        <span class="c1"># plot</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="n">ylineout</span> <span class="o">=</span> <span class="n">osh5vis</span><span class="o">.</span><span class="n">osplot1d</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">convert_xaxis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">if_y_phys_unit</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axy</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">transpose</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># add widgets (color picker + delete button)</span>
        <span class="n">nw</span> <span class="o">=</span> <span class="n">_get_delete_btn</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span>
        <span class="n">nw</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__remove_ylineout</span><span class="p">)</span>
        <span class="n">co</span> <span class="o">=</span> <span class="n">ylineout</span><span class="o">.</span><span class="n">get_color</span><span class="p">()</span>
        <span class="n">cpk</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ColorPicker</span><span class="p">(</span><span class="n">concise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">descr</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">co</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span>
                                  <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">px&#39;</span> <span class="o">%</span> <span class="n">wgt_width</span><span class="p">))</span>
        <span class="n">cpk</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__set_ylineout_color</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="n">lineout_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="n">cpk</span><span class="p">,</span> <span class="n">nw</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">px&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wgt_width</span> <span class="o">+</span> <span class="mi">50</span><span class="p">),</span> <span class="n">border</span><span class="o">=</span><span class="s1">&#39;solid 1px&#39;</span><span class="p">,</span> <span class="n">flex</span><span class="o">=</span><span class="s1">&#39;0 0 auto&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ylineout_list_wgt</span><span class="o">.</span><span class="n">children</span> <span class="o">+=</span> <span class="p">(</span><span class="n">lineout_wgt</span><span class="p">,)</span>
        <span class="c1"># register a new lineout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ylineouts</span><span class="p">[</span><span class="n">nw</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylineouts</span><span class="p">[</span><span class="n">cpk</span><span class="p">]</span> <span class="o">=</span> <span class="n">lineout_wgt</span><span class="p">,</span> <span class="n">ylineout</span>

    <span class="k">def</span> <span class="nf">get_ylineout_data_and_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">label2int</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">loc</span><span class="p">)</span>
        <span class="n">posstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">pos</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[:,</span> <span class="n">pos</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]),</span> <span class="n">posstr</span><span class="p">,</span> <span class="n">pos</span>

    <span class="k">def</span> <span class="nf">__add_ylineout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">posstr</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ylineout_data_and_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylineout_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">xconv</span><span class="p">)</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">pos</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; lineout&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__add_yline</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">posstr</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="mi">170</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__update_ylineout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylineouts</span><span class="p">:</span>
<span class="c1">#             for wgt in self.ylineout_list_wgt.children:</span>
<span class="c1">#                 pos = float(wgt.children[0].description)</span>
<span class="c1">#                 self._ylineouts[wgt.children[0]].set_xdata(self.__pp(self._data[self._slcs].loc[:, pos]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__update_twiny_scale</span><span class="p">()</span>
            <span class="c1">#TODO: autoscale for &#39;log&#39; scale doesn&#39;t work after plotting the line, we have to do it manually</span>
            <span class="c1">#TDDO: a walkaround for a strange behavior of constrained_layout, should be removed in the future</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axy</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sample_rate_for_vminmax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">return</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">200</span> <span class="k">else</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">200</span> <span class="k">else</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__handle_lognorm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sample_rate_for_vminmax</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmin_auto</span><span class="o">.</span><span class="n">value</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmax_auto</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">values</span><span class="p">[::</span><span class="n">dy</span><span class="p">,</span> <span class="p">::</span><span class="n">dx</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_selector</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">LogNorm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__pp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmin_auto</span><span class="o">.</span><span class="n">value</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmax_auto</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">logv</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">logv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">logv</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmin_auto</span><span class="o">.</span><span class="n">value</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">vlogmin_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vlogmin_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">vmin</span> <span class="k">if</span> <span class="n">vmin</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmax_auto</span><span class="o">.</span><span class="n">value</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">vmax_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vmax_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">vmax</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vmax_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vlogmin_wgt</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmax_auto</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vmax_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">vmax</span> <span class="k">if</span> <span class="n">vmax</span> <span class="o">&gt;</span> <span class="n">vmin</span> <span class="k">else</span> <span class="n">vmin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmin_auto</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vlogmin_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">vmin</span> <span class="k">if</span> <span class="n">vmin</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmin_auto</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vmin_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmax_auto</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vmax_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__pp</span> <span class="o">=</span> <span class="n">do_nothing</span>

    <span class="k">def</span> <span class="nf">__update_norm_wgt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;update tab1 (second tab) only and prepare _log_data if necessary&quot;&quot;&quot;</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tab_contents</span><span class="p">)</span>
        <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tab_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_tab_wgt</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__handle_lognorm</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">current_vmin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_selector</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@current_vmin</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">current_vmin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm_selector</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">__get_vminmax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_widgets</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">from_widgets</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_vmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vmax_wgt</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmin_auto</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_vmin</span><span class="p">,</span>
                    <span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmax_auto</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">vmax_wgt</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__axis_descr_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">osh5vis</span><span class="o">.</span><span class="n">axis_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">comp</span><span class="p">]</span><span class="o">.</span><span class="n">long_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">comp</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="c1"># only changing clim</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__old_norm</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_selector</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pltfunc</span> <span class="ow">is</span> <span class="n">osh5vis</span><span class="o">.</span><span class="n">osimshow</span><span class="p">:</span>
                <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_vminmax</span><span class="p">(</span><span class="n">from_widgets</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">set_clim</span><span class="p">([</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_replot_contour</span><span class="p">()</span>
        <span class="c1"># norm change</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__old_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_selector</span><span class="o">.</span><span class="n">value</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_selector</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">LogNorm</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__pp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_slcs</span><span class="p">])</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__update_xlineout</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__update_ylineout</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">set_norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_norm</span><span class="p">())</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="c1">#TODO: walkaround for an upstream bug: https://github.com/matplotlib/matplotlib/issues/5424</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">autoscale</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">update_bruteforce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_contours</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__get_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vminmax_from_widget</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_vminmax</span><span class="p">(</span><span class="n">from_widgets</span><span class="o">=</span><span class="n">vminmax_from_widget</span><span class="p">)</span>
        <span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;vmin&#39;</span><span class="p">:</span> <span class="n">vmin</span><span class="p">,</span> <span class="s1">&#39;vmax&#39;</span><span class="p">:</span> <span class="n">vmax</span><span class="p">,</span> <span class="s1">&#39;clip&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_clip_cm</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_selector</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">PowerNorm</span><span class="p">:</span>
            <span class="n">param</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_selector</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">SymLogNorm</span><span class="p">:</span>
            <span class="n">param</span><span class="p">[</span><span class="s1">&#39;linthresh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linthresh</span><span class="o">.</span><span class="n">value</span>
            <span class="n">param</span><span class="p">[</span><span class="s1">&#39;linscale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linscale</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="n">param</span>

<span class="c1">#     def __assgin_valid_vmin(self, v=None):</span>
<span class="c1">#         # if it is log scale</span>
<span class="c1">#         dx, dy = self.__sample_rate_for_vminmax()</span>
<span class="c1">#         a = self._data.values[::dy, ::dx]</span>
<span class="c1">#         if self.norm_selector.value[0] == LogNorm:</span>
<span class="c1">#             self.vlogmin_wgt.value = np.min(np.abs(a[a!=0])) if v is None else v</span>
<span class="c1">#         else:</span>
<span class="c1">#             self.vmin_wgt.value = np.min(a) if v is None else v</span>

    <span class="k">def</span> <span class="nf">__add_colorbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">clb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbar</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="o">=</span> <span class="n">osh5vis</span><span class="o">.</span><span class="n">add_colorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="n">cblabel</span><span class="o">=</span><span class="n">clb</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__toggle_colorbar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbar</span><span class="o">.</span><span class="n">disabled</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_reset_cbar</span><span class="o">.</span><span class="n">disabled</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap_selector</span><span class="o">.</span><span class="n">disabled</span><span class="p">,</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">cmap_reverse</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__update_cbar</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__add_colorbar</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbar</span><span class="o">.</span><span class="n">disabled</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_reset_cbar</span><span class="o">.</span><span class="n">disabled</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap_selector</span><span class="o">.</span><span class="n">disabled</span><span class="p">,</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">cmap_reverse</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
<span class="c1">#         self.replot_axes()</span>

    <span class="k">def</span> <span class="nf">__update_vmin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_change</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmin_auto</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
<span class="c1">#             self.__assgin_valid_vmin()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__handle_lognorm</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vmin_wgt</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vlogmin_wgt</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vmin_wgt</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vlogmin_wgt</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__update_vmax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_change</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_vmax_auto</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
<span class="c1">#             self.vmax_wgt.value = np.max(self.__pp(self._data[self._slcs]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__handle_lognorm</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vmax_wgt</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vmax_wgt</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__update_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_reset_title</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datalabel</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">osh5vis</span><span class="o">.</span><span class="n">default_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">show_time</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datalabel</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datalabel</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__update_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xlabel</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlabel</span>

    <span class="k">def</span> <span class="nf">__update_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ylabel</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylabel</span>

    <span class="k">def</span> <span class="nf">__update_cbar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_reset_cbar</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbar</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">tex</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbar</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbar</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__reset_save_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveas</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveas</span><span class="o">.</span><span class="n">tooltip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveas</span><span class="o">.</span><span class="n">button_style</span><span class="o">=</span> \
        <span class="s1">&#39;Save current plot&#39;</span><span class="p">,</span> <span class="s1">&#39;save current plot&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__savefig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figname</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="c1">#             self.dlink.clear_output(wait=True)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dlink</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlink</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">_get_downloadable_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figname</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="s1">&#39;Download:&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__reset_save_button</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveas</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveas</span><span class="o">.</span><span class="n">tooltip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveas</span><span class="o">.</span><span class="n">button_style</span><span class="o">=</span> \
                    <span class="s1">&#39;Permission Denied&#39;</span><span class="p">,</span> <span class="s1">&#39;please try another directory&#39;</span><span class="p">,</span> <span class="s1">&#39;danger&#39;</span>

    <span class="k">def</span> <span class="nf">__try_savefig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="n">pdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figname</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="n">path_exist</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pdir</span><span class="p">)</span>
        <span class="n">file_exist</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figname</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path_exist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file_exist</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveas</span><span class="o">.</span><span class="n">button_style</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">saveas</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveas</span><span class="o">.</span><span class="n">tooltip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveas</span><span class="o">.</span><span class="n">button_style</span><span class="o">=</span> \
                    <span class="s1">&#39;Overwirte file&#39;</span><span class="p">,</span> <span class="s1">&#39;overwrite existing file&#39;</span><span class="p">,</span> <span class="s1">&#39;warning&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__savefig</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__savefig</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveas</span><span class="o">.</span><span class="n">button_style</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">saveas</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveas</span><span class="o">.</span><span class="n">tooltip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveas</span><span class="o">.</span><span class="n">button_style</span><span class="o">=</span> \
                <span class="s1">&#39;Create path &amp; save&#39;</span><span class="p">,</span> <span class="s1">&#39;create non-existing path and save&#39;</span><span class="p">,</span> <span class="s1">&#39;warning&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">pdir</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__savefig</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Slicer</span><span class="p">(</span><span class="n">Generic2DPlotCtrl</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">extra_kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;data must be 3 dimensional&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_slice</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_pos</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">],</span>
                                          <span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__axis_format</span><span class="p">(),</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;index:&#39;</span><span class="p">,</span>
                                              <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axis_selector</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ndim</span><span class="p">)),</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;axis:&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_pos_in_title</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Slider position in title&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Slicer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slcs</span><span class="p">)],</span> <span class="n">slcs</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">slcs</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">int</span><span class="p">)),</span>
                                     <span class="n">time_in_title</span><span class="o">=</span><span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">has_axis</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">extra_kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_selector</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_slice_direction</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_slider</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_slice</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_pos</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__update_index_slider</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_pos_in_title</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_title</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="c1">#TODO: this is probably not a good design as it might break anytime we change the structure of tab0, refactory needed.</span>
        <span class="c1"># add the check box to tab0,</span>
<span class="c1">#         tmp = [None] * len(self.tab_contents)</span>
<span class="c1">#         tmp[0] = self.get_tab_data()</span>
<span class="c1">#         self.refresh_tab_wgt(tmp)</span>

    <span class="k">def</span> <span class="nf">get_tab_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">norm_selector</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_selector</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_btn_wgt</span><span class="p">,</span>
                             <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">datalabel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_reset_title</span><span class="p">]),</span>
                                           <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">if_show_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_in_phys</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_pos_in_title</span><span class="p">])])</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">widgets_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_slider</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_selector</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_main</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_slider</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_selector</span><span class="p">]),</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">out_main</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__update_index_slider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_change</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_slider</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_pos</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
                                        <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">]</span><span class="o">.</span><span class="n">increment</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__axis_format</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">osh5vis</span><span class="o">.</span><span class="n">axis_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">]</span><span class="o">.</span><span class="n">long_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">slcs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ndim</span>
        <span class="n">slcs</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">slcs</span>

    <span class="k">def</span> <span class="nf">get_plot_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">datalabel</span><span class="o">.</span><span class="n">value</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_time_label</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_show_time</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_pos_in_title</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_pos</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">n</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_pos</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">u</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="n">t</span><span class="p">)</span> <span class="k">if</span> <span class="n">l</span> <span class="k">else</span> <span class="n">t</span>
        <span class="k">return</span> <span class="n">title</span> <span class="o">+</span> <span class="p">((</span><span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="n">pos</span><span class="p">)</span> <span class="k">if</span> <span class="n">pos</span> <span class="k">else</span> <span class="n">pos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">switch_slice_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slcs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">__get_slice</span><span class="p">(</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]),</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]]</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_slider_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_axis_descr</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slcs</span><span class="p">)],</span> <span class="n">slcs</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">slcs</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">int</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_plot_area</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replot_axes</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reset_slider_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># stop the observe while updating values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_slider</span><span class="o">.</span><span class="n">unobserve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_slice</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_slider</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_axis_value</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_slider</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_slice</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__update_axis_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_pos</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__update_axis_descr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_pos</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__axis_format</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">update_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_axis_value</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slcs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redraw</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slcs</span><span class="p">)])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_pos_in_title</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_title</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">SaveMovieManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">gen1frame</span><span class="p">,</span> <span class="n">frame_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">frame_range_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen1frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">figdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">basename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_range_opts</span> <span class="o">=</span> <span class="n">fig</span><span class="p">,</span> <span class="n">gen1frame</span><span class="p">,</span> <span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="s1">&#39;movie&#39;</span><span class="p">,</span> <span class="n">frame_range_opts</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">stdout</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;ffmpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;-encoders&#39;</span><span class="p">,</span> <span class="s1">&#39;-v&#39;</span><span class="p">,</span> <span class="s1">&#39;quiet&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="n">stdout</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="c1">#TODO: sane options for each encoder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">known_encoders</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;libx265&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;-crf&quot;</span><span class="p">,</span> <span class="s2">&quot;18&quot;</span><span class="p">,</span> <span class="s2">&quot;-preset&quot;</span><span class="p">,</span> <span class="s2">&quot;slow&quot;</span><span class="p">],</span>
                               <span class="s1">&#39;hevc&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;-crf&quot;</span><span class="p">,</span> <span class="s2">&quot;18&quot;</span><span class="p">,</span> <span class="s2">&quot;-preset&quot;</span><span class="p">,</span> <span class="s2">&quot;slow&quot;</span><span class="p">],</span>
                               <span class="s1">&#39;libx264&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;-tune&quot;</span><span class="p">,</span> <span class="s2">&quot;stillimage&quot;</span><span class="p">,</span> <span class="s2">&quot;-crf&quot;</span><span class="p">,</span> <span class="s2">&quot;18&quot;</span><span class="p">,</span> <span class="s2">&quot;-preset&quot;</span><span class="p">,</span> <span class="s2">&quot;slow&quot;</span><span class="p">,</span> <span class="s2">&quot;-pix_fmt&quot;</span><span class="p">,</span> <span class="s2">&quot;yuv420p&quot;</span><span class="p">],</span>
                               <span class="s1">&#39;h264&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;-tune&quot;</span><span class="p">,</span> <span class="s2">&quot;stillimage&quot;</span><span class="p">,</span> <span class="s2">&quot;-crf&quot;</span><span class="p">,</span> <span class="s2">&quot;18&quot;</span><span class="p">,</span> <span class="s2">&quot;-preset&quot;</span><span class="p">,</span> <span class="s2">&quot;slow&quot;</span><span class="p">,</span> <span class="s2">&quot;-pix_fmt&quot;</span><span class="p">,</span> <span class="s2">&quot;yuv420p&quot;</span><span class="p">],</span>
                               <span class="s1">&#39;mpeg4&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;-q:v&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">],</span> <span class="s1">&#39;mpeg&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;flv&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;qtrle&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;rawvideo&#39;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="k">for</span> <span class="n">encoder</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">known_encoders</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">encoder</span> <span class="ow">in</span> <span class="n">stdout</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dflt_savename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dflt_btn_dscr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dflt_btn_tp</span> <span class="o">=</span> \
                <span class="n">encoder</span><span class="p">,</span> <span class="s1">&#39;movie.mp4&#39;</span><span class="p">,</span> <span class="s1">&#39;Generate movie&#39;</span><span class="p">,</span> <span class="s1">&#39;convert a series of plots into a movie&#39;</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dflt_savename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dflt_btn_dscr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dflt_btn_tp</span> <span class="o">=</span> \
            <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;movie.tgz&#39;</span><span class="p">,</span> <span class="s1">&#39;Generate tar file&#39;</span><span class="p">,</span> <span class="s1">&#39;ffmpeg not found. A tgz file will be generated.&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedIntText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;FPS:&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_range</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">SelectionRangeSlider</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;movie range:&#39;</span><span class="p">,</span>
                                                        <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">,</span> <span class="s1">&#39;min_width&#39;</span><span class="p">:</span> <span class="s1">&#39;220px&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_frame_range</span><span class="p">(</span><span class="n">frame_range</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dflt_savename</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Movie name:&#39;</span><span class="p">,</span> <span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;movie name&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dflt_btn_dscr</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dflt_btn_tp</span><span class="p">,</span> <span class="n">button_style</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deletetemp</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Delete temporary figures&#39;</span><span class="p">,</span>
                                           <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smm_output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlink</span> <span class="o">=</span> <span class="n">Output</span><span class="p">(),</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">whatif_file_exist</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">RadioButtons</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;delete conflicting png files and continue&#39;</span><span class="p">,</span> <span class="s1">&#39;skip existing files&#39;</span><span class="p">,</span>
                                                               <span class="s1">&#39;create new temporary directory&#39;</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;skip existing files&#39;</span><span class="p">,</span>
                                                      <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="c1"># link widget events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_savename</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_figures</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">widgets_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deletetemp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlink</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">smm_output</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deletetemp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">),</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">dlink</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">smm_output</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_frame_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_range</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">frame_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">starting</span><span class="p">,</span> <span class="n">ending</span> <span class="o">=</span> <span class="n">frame_range</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_range</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">frame_range</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_range_opts</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">starting</span><span class="p">,</span> <span class="n">ending</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_range</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_range_opts</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_range</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">starting</span><span class="p">,</span> <span class="n">ending</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">set_savename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__reset_save_button</span><span class="p">()</span>
<span class="c1">#         self.smm_output.clear_output()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__reset_save_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">tooltip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">button_style</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">dflt_btn_dscr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dflt_btn_tp</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_delete_temp_fig_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">deleteme</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">basename</span> <span class="o">+</span> <span class="s1">&#39;-*.png&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">tooltip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">button_style</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> \
        <span class="s2">&quot;Deleting&quot;</span><span class="p">,</span> <span class="s1">&#39;Unstopptable&#39;</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">deleteme</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle_path_file_conflict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; what to do when user press the button. return True to indicate no further action required &quot;&quot;&quot;</span>
<span class="c1">#         self.smm_output.clear_output()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">button_style</span> <span class="o">==</span> <span class="s1">&#39;warning&#39;</span><span class="p">:</span>  <span class="c1"># second press, we have path/file problem to sort out</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">whatif_file_exist</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_delete_temp_fig_files</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">whatif_file_exist</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">figdir</span> <span class="o">+=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;__%Y-%m-</span><span class="si">%d</span><span class="s1">_%H-%M-%S&#39;</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figdir</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">button_style</span> <span class="o">==</span> <span class="s1">&#39;info&#39;</span><span class="p">:</span>  <span class="c1"># second or third press, we are generating the movie, user call for abort</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__reset_save_button</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">button_style</span><span class="p">:</span>  <span class="c1"># user press the button for the first time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">tooltip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">button_style</span> <span class="o">=</span> \
            <span class="s1">&#39;continue&#39;</span><span class="p">,</span> <span class="s1">&#39;continue with selected option&#39;</span><span class="p">,</span> <span class="s1">&#39;warning&#39;</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">smm_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;directory &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">figdir</span> <span class="o">+</span> <span class="s1">&#39; not empty&#39;</span><span class="p">)</span>
                <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">whatif_file_exist</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__encode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">:</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;ffmpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;-framerate&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                                         <span class="s2">&quot;-start_number&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_range</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                         <span class="s2">&quot;-i&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">figdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">basename</span> <span class="o">+</span> <span class="s1">&#39;-</span><span class="si">%06d</span><span class="s1">.png&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;-c:v&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">known_encoders</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">],</span>
                                         <span class="s1">&#39;-y&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">value</span><span class="p">],</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;tar&quot;</span><span class="p">,</span> <span class="s2">&quot;-cvzf&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">+</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">basename</span> <span class="o">+</span> <span class="s1">&#39;-*.png&#39;</span><span class="p">),</span>
                                        <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__reset_save_button</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">smm_output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">smm_output</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_plot_and_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_range</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_range</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__savefig</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;(</span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2">) done&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_range</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_range</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_range</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Encoding&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__encode</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">deletetemp</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_delete_temp_fig_files</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figdir</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dlink</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlink</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">_get_downloadable_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="s1">&#39;Download:&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__reset_save_button</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smm_output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">generate_figures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">value</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">basename</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figdir</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figdir</span><span class="p">)</span>
            <span class="c1"># find out whether we are risking overwriting files</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="s1">&#39;*.png&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_path_file_conflict</span><span class="p">():</span>
                    <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">tooltip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">button_style</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> \
            <span class="s2">&quot;Generating Frames&quot;</span><span class="p">,</span> <span class="s1">&#39;Use menu &quot;Kernel --&gt; interrput&quot; to stop&#39;</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="kc">True</span>
            <span class="c1">#TODO: matplotlib is not thread safe so we have to plot in the main thread (need further investigation)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot_and_encode</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">tooltip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">savebtn</span><span class="o">.</span><span class="n">button_style</span> <span class="o">=</span> \
                        <span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;please try another path&#39;</span><span class="p">,</span> <span class="s1">&#39;danger&#39;</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">smm_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Permission Denied: cannot write to &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">figdir</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__reset_save_button</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__savefig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="n">savename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">basename</span> <span class="o">+</span> <span class="s1">&#39;-</span><span class="si">{:06d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">savename</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">whatif_file_exist</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gen1frame</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savename</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DirSlicer</span><span class="p">(</span><span class="n">Generic2DPlotCtrl</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filefilter</span><span class="p">,</span> <span class="n">processing</span><span class="o">=</span><span class="n">do_nothing</span><span class="p">,</span> <span class="n">savemovie</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">extra_kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filefilter</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>  <span class="c1"># filefilter is a list of filenames</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datadir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filefilter</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">filefilter</span><span class="p">,</span> <span class="n">processing</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># filefilter is a path name or a string that can be passed down to glob to get a list of file names</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="n">filefilter</span> <span class="o">+</span> <span class="s1">&#39;/*.h5&#39;</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">filefilter</span><span class="p">)</span> <span class="k">else</span> <span class="n">filefilter</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datadir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fp</span><span class="p">)),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">fp</span><span class="p">)),</span> <span class="n">processing</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">processing</span><span class="p">(</span><span class="n">osh5io</span><span class="o">.</span><span class="n">read_h5</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flist</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;No file found matching &#39;</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flist</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flist</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                             <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">osh5vis</span><span class="o">.</span><span class="n">time_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">run_attrs</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">run_attrs</span><span class="p">[</span><span class="s1">&#39;TIME UNITS&#39;</span><span class="p">]),</span>
                                        <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">DirSlicer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">time_in_title</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">extra_kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">savemovie</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">savemovie</span> <span class="o">=</span> <span class="n">SaveMovieManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_ith_slice</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flist</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">savemovie</span> <span class="o">=</span> <span class="n">savemovie</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">savemovie</span><span class="o">.</span><span class="n">update_frame_range</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flist</span><span class="p">)))</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tab_contents</span><span class="p">)</span>
        <span class="n">tmp</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_tab_save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_tab_wgt</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_slider</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_slice</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">widgets_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_slider</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_main</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">file_slider</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_main</span><span class="p">])</span>

    <span class="c1"># cannot overload get_tab_save() because of circular dependent between SaveMovieManager __init__ and Generic2DPlotCtrl __init__</span>
    <span class="k">def</span> <span class="nf">__get_tab_save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">figname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveas</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">),</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">dlink</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">savemovie</span><span class="o">.</span><span class="n">widget</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_ith_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;new&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_slice</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_slider</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flist</span><span class="p">[</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing</span><span class="p">(</span><span class="n">osh5io</span><span class="o">.</span><span class="n">read_h5</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flist</span><span class="p">[</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">osh5vis</span><span class="o">.</span><span class="n">time_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">run_attrs</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">run_attrs</span><span class="p">[</span><span class="s1">&#39;TIME UNITS&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redraw</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">update_vminmax</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">newfile</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_lineouts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_contours</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_show_time</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
<span class="c1">#             self.update_time_label()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_title</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">select_ith_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_slider</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">i</span>


<span class="k">class</span> <span class="nc">MultiPanelCtrl</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workers</span><span class="p">,</span> <span class="n">data_list</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">worker_kw_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fig_ax</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(),</span> <span class="n">output_widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; worker&#39;s base class should be Generic2DPlotCtrl &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">*</span><span class="n">grid</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;grid must have 2 elements specifying a grid of plots. Total number of plots must be greater than 1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span> <span class="o">=</span> <span class="n">grid</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Expecting </span><span class="si">%d</span><span class="s1"> lists in data_list, got </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrows</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">)))</span>

        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">figsize</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span> <span class="o">=</span> <span class="n">output_widget</span> <span class="ow">or</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span>
        <span class="n">nplots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span>
        <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,]</span> <span class="o">*</span> <span class="n">nplots</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,]</span> <span class="o">*</span> <span class="n">nplots</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">sharex</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;col&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nplots</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="p">):</span>
                <span class="n">xlabel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">sharey</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;row&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nplots</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ylabel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">worker_kw_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">worker_kw_list</span> <span class="o">=</span> <span class="p">({},</span> <span class="p">)</span> <span class="o">*</span> <span class="n">nplots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">fig_ax</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="n">sharex</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">,</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">dstr</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;onDestruction&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">self_destruct</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worker</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">output_widget</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlb</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylb</span><span class="p">,</span> <span class="n">onDestruction</span><span class="o">=</span><span class="n">dstr</span><span class="p">,</span> <span class="o">**</span><span class="n">wkw</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                       <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">xlb</span><span class="p">,</span> <span class="n">ylb</span><span class="p">,</span> <span class="n">wkw</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">workers</span><span class="p">,</span> <span class="n">data_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">worker_kw_list</span><span class="p">)]</span>
        <span class="n">data_namelist</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">get_dataname</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">]</span>
        <span class="c1"># register callbacks for shared axes</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">sharex</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">):</span>
                <span class="n">w</span><span class="o">.</span><span class="n">register_callbacks</span><span class="p">({</span><span class="s1">&#39;sharedx&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]})</span>
            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">:</span>
                <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">if_xrange_auto</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">if_xrange_auto</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">sharex</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;col&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">):</span>
                <span class="n">col</span><span class="p">,</span> <span class="n">row</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="p">,</span> <span class="n">i</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span>
                <span class="n">sel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">[</span><span class="n">col</span><span class="p">::</span><span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="p">]</span>
                <span class="n">w</span><span class="o">.</span><span class="n">register_callbacks</span><span class="p">({</span><span class="s1">&#39;sharedx&#39;</span><span class="p">:</span> <span class="n">sel</span><span class="p">[:</span><span class="n">row</span><span class="p">]</span> <span class="o">+</span> <span class="n">sel</span><span class="p">[</span><span class="n">row</span><span class="o">+</span><span class="mi">1</span><span class="p">:]})</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="p">):</span>
                    <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">if_xrange_auto</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="o">*</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">if_xrange_auto</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">sharey</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">):</span>
                <span class="n">w</span><span class="o">.</span><span class="n">register_callbacks</span><span class="p">({</span><span class="s1">&#39;sharedy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]})</span>
            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">:</span>
                <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">if_yrange_auto</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">if_yrange_auto</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">sharey</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;row&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">):</span>
                <span class="n">col</span><span class="p">,</span> <span class="n">row</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="p">,</span> <span class="n">i</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span>
                <span class="n">sel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">[</span><span class="n">row</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span> <span class="p">:</span> <span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="p">]</span>
                <span class="n">w</span><span class="o">.</span><span class="n">register_callbacks</span><span class="p">({</span><span class="s1">&#39;sharedy&#39;</span><span class="p">:</span> <span class="n">sel</span><span class="p">[:</span><span class="n">col</span><span class="p">]</span> <span class="o">+</span> <span class="n">sel</span><span class="p">[</span><span class="n">col</span><span class="o">+</span><span class="mi">1</span><span class="p">:]})</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="p">):</span>
                    <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="p">]</span><span class="o">.</span><span class="n">if_yrange_auto</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="o">+</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">if_yrange_auto</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="c1"># adding the index in front to make sure all button names are unique (otherwise the selection wouldn&#39;t be highlighted properly)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_namelist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data_namelist</span><span class="p">)):</span>
            <span class="n">data_namelist</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">s</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_namelist</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabd</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">tab</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">]</span>
        <span class="n">bw</span><span class="p">,</span> <span class="n">bwpadded</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">56</span>  <span class="c1"># these magic numbers seems to work well on forcing the desired button layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tb</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ToggleButtons</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">data_namelist</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">data_namelist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="n">data_namelist</span><span class="p">,</span>
                                        <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;button_width&quot;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">px&#39;</span> <span class="o">%</span> <span class="n">bw</span><span class="p">})</span>
        <span class="n">ctrl_pnl</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Box</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">tb</span><span class="p">],</span><span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s1">&#39;flex&#39;</span><span class="p">,</span> <span class="n">flex</span><span class="o">=</span><span class="s1">&#39;0 0 auto&#39;</span><span class="p">,</span> <span class="n">align_items</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                                                       <span class="n">width</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">px&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bwpadded</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="n">ctrl_pnl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabd</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tb</span><span class="o">.</span><span class="n">index</span><span class="p">]],</span> <span class="n">layout</span><span class="o">=</span><span class="n">_items_layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suptitle_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Suptitle:&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_in_suptitle</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Time in suptitle, &#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_in_phys_unit</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;time in physical unit&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suptitle</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">suptitle_wgt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_in_suptitle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_in_phys_unit</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tb</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_corresponding_tab</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suptitle_wgt</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_suptitle</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_in_suptitle</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_suptitle</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_in_phys_unit</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_suptitle</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">widgets_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">suptitle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">out</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_time_label</span><span class="p">(</span><span class="n">convert_tunit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_in_phys_unit</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">self_destruct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suptitle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">update_suptitle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">suptitle_wgt</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">ttl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suptitle_wgt</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="p">((</span><span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_in_suptitle</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ttl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_in_suptitle</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">ttl</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show_corresponding_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabd</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tb</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">MPDirSlicer</span><span class="p">(</span><span class="n">MultiPanelCtrl</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filefilter_list</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">processing</span><span class="o">=</span><span class="n">do_nothing</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fig_ax</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(),</span> <span class="n">output_widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">worker_kw_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">worker_kw_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">worker_kw_list</span> <span class="o">=</span> <span class="p">[{},]</span> <span class="o">*</span> <span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processing</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">processing</span><span class="p">)</span> <span class="o">!=</span> <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Expecting </span><span class="si">%d</span><span class="s1"> functions in processing, got </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">processing</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ps</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;processing&#39;</span> <span class="p">:</span><span class="n">p</span><span class="p">}</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processing</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ps</span> <span class="o">=</span> <span class="p">({</span><span class="s1">&#39;processing&#39;</span> <span class="p">:</span><span class="n">processing</span><span class="p">},)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">filefilter_list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">kw</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">worker_kw_list</span><span class="p">,</span> <span class="n">ps</span><span class="p">):</span>
            <span class="n">kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="c1">#TODO: replicating some lines in the super class. there should be a better way &gt;&gt;&gt;&gt;&gt;</span>
        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">figsize</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">fig_ax</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="o">*</span><span class="n">grid</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="n">sharex</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">,</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#         fp = filefilter_list[0] + &#39;/*.h5&#39; if os.path.isdir(filefilter_list[0]) else filefilter_list[0]</span>
<span class="c1">#         flist = sorted(glob.glob(fp))</span>
        <span class="c1"># &lt;&lt;&lt;&lt;&lt; all because we need to initialize SaveMovieManager before super().__init__()</span>
        <span class="n">smm</span> <span class="o">=</span> <span class="n">SaveMovieManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_ith_slice_mp</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MPDirSlicer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">((</span><span class="n">DirSlicer</span><span class="p">,)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">filefilter_list</span><span class="p">),</span> <span class="n">filefilter_list</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">worker_kw_list</span><span class="o">=</span><span class="n">worker_kw_list</span><span class="p">,</span>
                                          <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">fig_ax</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">),</span> <span class="n">output_widget</span><span class="o">=</span><span class="n">output_widget</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">sharex</span><span class="p">,</span>
                                          <span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">,</span> <span class="n">onDestruction</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">self_destruct</span><span class="p">,</span> <span class="n">savemovie</span><span class="o">=</span><span class="n">smm</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># we need a master slider to control all subplot sliders</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">file_slider</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                        <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">play</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Play</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Press play&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_all_subplots</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">play</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">widgets_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">play</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">suptitle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">out</span>

    <span class="k">def</span> <span class="nf">self_destruct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time_label</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">play</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">self_destruct</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">plot_ith_slice_mp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;new&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_all_subplots</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_all_subplots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">file_slider</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_suptitle</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Animation</span><span class="p">(</span><span class="n">Slicer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Animation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">play</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Play</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">]),</span>
                                 <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Press play&quot;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">IntText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Interval:&#39;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step_wgt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">IntText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Step:&#39;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># link everything together</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">play</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_slider</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval_wgt</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_interval</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step_wgt</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_step</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">widgets_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_slider</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_selector</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">play</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_wgt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_wgt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_main</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">switch_slice_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Animation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">switch_slice_direction</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">play</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">update_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">play</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">update_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">play</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, PICKSC.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>